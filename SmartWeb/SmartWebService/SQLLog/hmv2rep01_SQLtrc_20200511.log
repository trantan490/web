SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT PLAN_WEEK V1    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_DATE = TO_CHAR(SYSDATE,'yyyymmdd')      AND ROWNUM = 1  
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD010401'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT FACTORY Code, FAC_DESC Data
  FROM MWIPFACDEF
 WHERE FAC_GRP_5 = 'Y' 
 ORDER BY FAC_GRP_4 ASC
-------------------------------------------------------------
SELECT OPER, OPER_DESC  FROM MWIPOPRDEF
  WHERE FACTORY = 'HMVA2'  AND OPER NOT IN ('00001', '00002') AND OPER NOT LIKE 'V%' ORDER BY DECODE(OPER_CMF_2, ' ', 99999, TO_NUMBER(OPER_CMF_2)), OPER
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
        SELECT (SELECT DATA_1 FROM MGCMTBLDAT WHERE TABLE_NAME = 'H_CUSTOMER' AND KEY_1 = MAT_GRP_1 AND ROWNUM=1) AS CUSTOMER,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', MAT_CMF_10, MAT_ID, OPER,  ' ', CASE WHEN OPER <= 'A0200' THEN VENDOR_MAT_ID ELSE BASE_MAT_ID END SAP_CODE
             , SUM(TOTAL) AS TOTAL
             , SUM(ASSY_END_QTY0 ) VAL0
             , SUM(ASSY_END_QTY1 ) VAL1
             , SUM(ASSY_END_QTY2 ) VAL2
             , SUM(ASSY_END_QTY3 ) VAL3
             , SUM(ASSY_END_QTY4 ) VAL4
             , SUM(ASSY_END_QTY5 ) VAL5
             , SUM(ASSY_END_QTY6 ) VAL6
             , SUM(ASSY_END_QTY7 ) VAL7
             , ROUND(SUM(TOTAL)/8, 1) AVG
          FROM (
               SELECT B.MAT_GRP_1,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', B.MAT_CMF_10, B.MAT_ID, A.OPER,  ' ', BASE_MAT_ID,VENDOR_MAT_ID 
                    , DECODE(WORK_DATE, '20200504', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY0
                    , DECODE(WORK_DATE, '20200505', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY1
                    , DECODE(WORK_DATE, '20200506', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY2
                    , DECODE(WORK_DATE, '20200507', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY3
                    , DECODE(WORK_DATE, '20200508', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY4
                    , DECODE(WORK_DATE, '20200509', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY5
                    , DECODE(WORK_DATE, '20200510', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY6
                    , DECODE(WORK_DATE, '20200511', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY7
                    , (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END) TOTAL
                 FROM (
                      SELECT FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                           , SUM(END_LOT) AS END_LOT
                           , SUM(END_QTY_1) AS END_QTY_1
                           , SUM(END_QTY_2) AS END_QTY_2
                           , SUM(SHIP_QTY_1) AS SHIP_QTY_1
                           , SUM(SHIP_QTY_2) AS SHIP_QTY_2
                        FROM (
                             SELECT FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                           , DECODE(SUBSTR(OPER,2,4),'0000',SUM(S1_OPER_IN_LOT+S2_OPER_IN_LOT+S3_OPER_IN_LOT),SUM(S1_END_LOT+S2_END_LOT+S3_END_LOT)) END_LOT
                           , DECODE(SUBSTR(OPER,2,4),'0000',SUM(S1_OPER_IN_QTY_1+S2_OPER_IN_QTY_1+S3_OPER_IN_QTY_1),SUM(S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1+S1_END_RWK_QTY_1 + S2_END_RWK_QTY_1 + S3_END_RWK_QTY_1)) END_QTY_1
                           , DECODE(SUBSTR(OPER,2,4),'0000',SUM(S1_OPER_IN_QTY_2+S2_OPER_IN_QTY_2+S3_OPER_IN_QTY_2),SUM(S1_END_QTY_2+S2_END_QTY_2+S3_END_QTY_2+S1_END_RWK_QTY_2 + S2_END_RWK_QTY_2 + S3_END_RWK_QTY_2)) END_QTY_2
                           , 0 SHIP_QTY_1
                           , 0 SHIP_QTY_2
                        FROM RSUMWIPMOV 
                       WHERE OPER NOT IN ('AZ010','TZ010','F0000','EZ010', 'SZ010', 'BZ010')
                    GROUP BY FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                   UNION ALL
                      SELECT CM_KEY_1 AS FACTORY, MAT_ID
                           , DECODE(CM_KEY_1,'HMVA2','AZ010','HMKT1','TZ010','FGS','F0000','HMKE1','EZ010','HMKS1','SZ010', 'BZ010') OPER
                           , LOT_TYPE, MAT_VER,  WORK_DATE,CM_KEY_3
                           , 0 END_LOT
                           , 0 END_QTY_1
                           , 0 END_QTY_2
                           , SUM(S1_FAC_OUT_QTY_1+S2_FAC_OUT_QTY_1+S3_FAC_OUT_QTY_1) SHIP_QTY_1
                           , SUM(S1_FAC_OUT_QTY_2+S2_FAC_OUT_QTY_2+S3_FAC_OUT_QTY_2) SHIP_QTY_2
                        FROM RSUMFACMOV 
                       WHERE FACTORY NOT IN ('RETURN')
                    GROUP BY CM_KEY_1, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                             )
                    GROUP BY FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                    )A
                  , MWIPMATDEF B 
              WHERE 1=1 
                AND A.FACTORY  = 'HMVA2' 
                AND A.FACTORY = B.FACTORY 
                AND A.MAT_ID = B.MAT_ID                
                AND A.MAT_VER = 1 
                AND B.MAT_VER = 1 
                AND B.MAT_TYPE = 'FG' 
                AND A.OPER LIKE '%'
                AND A.MAT_ID LIKE '%'  
                AND A.OPER NOT IN ('00001','00002') 
                AND A.WORK_DATE BETWEEN '20200504' AND '20200511' 
         )   
   WHERE TOTAL > 0           
GROUP BY MAT_GRP_1,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', MAT_CMF_10, MAT_ID, OPER,  ' ', BASE_MAT_ID,VENDOR_MAT_ID
ORDER BY MAT_GRP_1,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', MAT_CMF_10, MAT_ID, DECODE(OPER,'AISSUE','A0001','TISSUE','T0001','EISSUE','E0001',OPER),  ' ', BASE_MAT_ID,VENDOR_MAT_ID

-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD010503'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT PLAN_WEEK V1    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_DATE = TO_CHAR(SYSDATE,'yyyymmdd')      AND ROWNUM = 1  
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD010401'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT FACTORY Code, FAC_DESC Data
  FROM MWIPFACDEF
 WHERE FAC_GRP_5 = 'Y' 
 ORDER BY FAC_GRP_4 ASC
-------------------------------------------------------------
SELECT OPER, OPER_DESC  FROM MWIPOPRDEF
  WHERE FACTORY = 'HMVA2'  AND OPER NOT IN ('00001', '00002') AND OPER NOT LIKE 'V%' ORDER BY DECODE(OPER_CMF_2, ' ', 99999, TO_NUMBER(OPER_CMF_2)), OPER
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
        SELECT (SELECT DATA_1 FROM MGCMTBLDAT WHERE TABLE_NAME = 'H_CUSTOMER' AND KEY_1 = MAT_GRP_1 AND ROWNUM=1) AS CUSTOMER,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', MAT_CMF_10, MAT_ID, OPER,  ' ', CASE WHEN OPER <= 'A0200' THEN VENDOR_MAT_ID ELSE BASE_MAT_ID END SAP_CODE
             , SUM(TOTAL) AS TOTAL
             , SUM(ASSY_END_QTY0 ) VAL0
             , SUM(ASSY_END_QTY1 ) VAL1
             , SUM(ASSY_END_QTY2 ) VAL2
             , SUM(ASSY_END_QTY3 ) VAL3
             , SUM(ASSY_END_QTY4 ) VAL4
             , SUM(ASSY_END_QTY5 ) VAL5
             , ROUND(SUM(TOTAL)/6, 1) AVG
          FROM (
               SELECT B.MAT_GRP_1,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', B.MAT_CMF_10, B.MAT_ID, A.OPER,  ' ', BASE_MAT_ID,VENDOR_MAT_ID 
                    , DECODE(WORK_DATE, '20200504', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY0
                    , DECODE(WORK_DATE, '20200505', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY1
                    , DECODE(WORK_DATE, '20200506', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY2
                    , DECODE(WORK_DATE, '20200507', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY3
                    , DECODE(WORK_DATE, '20200508', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY4
                    , DECODE(WORK_DATE, '20200509', (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END),0) ASSY_END_QTY5
                    , (CASE WHEN OPER IN ('AZ010','SHIP','TZ010','F0000','EZ010', 'SZ010', 'BZ010') THEN SHIP_QTY_1 ELSE END_QTY_1 END) TOTAL
                 FROM (
                      SELECT FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                           , SUM(END_LOT) AS END_LOT
                           , SUM(END_QTY_1) AS END_QTY_1
                           , SUM(END_QTY_2) AS END_QTY_2
                           , SUM(SHIP_QTY_1) AS SHIP_QTY_1
                           , SUM(SHIP_QTY_2) AS SHIP_QTY_2
                        FROM (
                             SELECT FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                           , DECODE(SUBSTR(OPER,2,4),'0000',SUM(S1_OPER_IN_LOT+S2_OPER_IN_LOT+S3_OPER_IN_LOT),SUM(S1_END_LOT+S2_END_LOT+S3_END_LOT)) END_LOT
                           , DECODE(SUBSTR(OPER,2,4),'0000',SUM(S1_OPER_IN_QTY_1+S2_OPER_IN_QTY_1+S3_OPER_IN_QTY_1),SUM(S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1+S1_END_RWK_QTY_1 + S2_END_RWK_QTY_1 + S3_END_RWK_QTY_1)) END_QTY_1
                           , DECODE(SUBSTR(OPER,2,4),'0000',SUM(S1_OPER_IN_QTY_2+S2_OPER_IN_QTY_2+S3_OPER_IN_QTY_2),SUM(S1_END_QTY_2+S2_END_QTY_2+S3_END_QTY_2+S1_END_RWK_QTY_2 + S2_END_RWK_QTY_2 + S3_END_RWK_QTY_2)) END_QTY_2
                           , 0 SHIP_QTY_1
                           , 0 SHIP_QTY_2
                        FROM RSUMWIPMOV 
                       WHERE OPER NOT IN ('AZ010','TZ010','F0000','EZ010', 'SZ010', 'BZ010')
                    GROUP BY FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                   UNION ALL
                      SELECT CM_KEY_1 AS FACTORY, MAT_ID
                           , DECODE(CM_KEY_1,'HMVA2','AZ010','HMKT1','TZ010','FGS','F0000','HMKE1','EZ010','HMKS1','SZ010', 'BZ010') OPER
                           , LOT_TYPE, MAT_VER,  WORK_DATE,CM_KEY_3
                           , 0 END_LOT
                           , 0 END_QTY_1
                           , 0 END_QTY_2
                           , SUM(S1_FAC_OUT_QTY_1+S2_FAC_OUT_QTY_1+S3_FAC_OUT_QTY_1) SHIP_QTY_1
                           , SUM(S1_FAC_OUT_QTY_2+S2_FAC_OUT_QTY_2+S3_FAC_OUT_QTY_2) SHIP_QTY_2
                        FROM RSUMFACMOV 
                       WHERE FACTORY NOT IN ('RETURN')
                    GROUP BY CM_KEY_1, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                             )
                    GROUP BY FACTORY, MAT_ID, OPER, LOT_TYPE, MAT_VER, WORK_DATE, CM_KEY_3
                    )A
                  , MWIPMATDEF B 
              WHERE 1=1 
                AND A.FACTORY  = 'HMVA2' 
                AND A.FACTORY = B.FACTORY 
                AND A.MAT_ID = B.MAT_ID                
                AND A.MAT_VER = 1 
                AND B.MAT_VER = 1 
                AND B.MAT_TYPE = 'FG' 
                AND A.OPER LIKE '%'
                AND A.MAT_ID LIKE '%'  
                AND A.OPER NOT IN ('00001','00002') 
                AND A.WORK_DATE BETWEEN '20200504' AND '20200509' 
         )   
   WHERE TOTAL > 0           
GROUP BY MAT_GRP_1,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', MAT_CMF_10, MAT_ID, OPER,  ' ', BASE_MAT_ID,VENDOR_MAT_ID
ORDER BY MAT_GRP_1,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', MAT_CMF_10, MAT_ID, DECODE(OPER,'AISSUE','A0001','TISSUE','T0001','EISSUE','E0001',OPER),  ' ', BASE_MAT_ID,VENDOR_MAT_ID

-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
 SELECT PLAN_WEEK V1    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_DATE = TO_CHAR(SYSDATE,'yyyymmdd')      AND ROWNUM = 1  
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PQC030110'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT DISTINCT CHAR_ID 
 FROM(  
       SELECT NVL((SELECT CHAR_ID 
                     FROM MEDCLOTDAT 
         WHERE  1=1 AND COL_SET_ID IN (SELECT COL_SET_ID FROM MEDCCOLDEF WHERE 1=1 AND COL_GRP_10='Visual'  AND DELETE_FLAG <> 'Y'   
            AND DELETE_FLAG <> 'Y' AND FACTORY=PQ.FACTORY)  
          AND LOT_ID = PQ.LOT_ID  AND VALUE_1 <> ' '  AND HIST_SEQ= PQ.HIST_SEQ and rownum=1),'-') AS CHAR_ID , TOTAL_DEFECT_QTY_1 
       FROM CPQCLOTHIS@RPTTOMES PQ  
               , MWIPMATDEF MAT   
      WHERE 1 = 1 
              AND PQ.FACTORY = 'HMVA2'  
              AND PQ.FACTORY = MAT.FACTORY  
              AND PQ.MAT_ID = MAT.MAT_ID  
        AND MAT.FACTORY (+) = 'HMVA2' 
              AND PQ.TRAN_TIME  BETWEEN '20200310220000' AND '20200511215959'  
    ) WHERE TOTAL_DEFECT_QTY_1 > 0  

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' 
       , QC_OPER, TRAN_TIME, QC_TYPE 
       , MAT_ID, LOT_ID, RES_ID, QTY_1, CUSTOMER, ASSE_SITE, LEAD_COUNT, H_PACKAGE, DENSITY, QC_OPERATOR ,SAMPLE_QTY 
       , SUM(TOTAL_DEFECT_QTY_1) AS TOTAL_QTY  , PPM, CMF_2 
       , DECODE(QC_FLAG, 'Y', 'PASS', 'FAIL') AS QC_FLAG  
       , SUM(DECODE(CHAR_ID , 'Chip Crack' ,TOTAL_DEFECT_QTY_1,0))  AS "Chip Crack"
       , SUM(DECODE(CHAR_ID , 'Etc' ,TOTAL_DEFECT_QTY_1,0))  AS "Etc"
       , SUM(DECODE(CHAR_ID , 'Ball Size' ,TOTAL_DEFECT_QTY_1,0))  AS "Ball Size"
       , SUM(DECODE(CHAR_ID , 'Pad Open (Ball Lift)' ,TOTAL_DEFECT_QTY_1,0))  AS "Pad Open (Ball Lift)"
       , SUM(DECODE(CHAR_ID , 'CCS Sheet Recording NG' ,TOTAL_DEFECT_QTY_1,0))  AS "CCS Sheet Recording NG"
       , SUM(DECODE(CHAR_ID , 'CCS basic information NG' ,TOTAL_DEFECT_QTY_1,0))  AS "CCS basic information NG"
       , SUM(DECODE(CHAR_ID , '-' ,TOTAL_DEFECT_QTY_1,0))  AS "-"
       , SUM(DECODE(CHAR_ID , 'T-Card Recording Defect' ,TOTAL_DEFECT_QTY_1,0))  AS "T-Card Recording Defect"
 FROM( 
       SELECT  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' 
              , PQ.QC_OPER 
              , PQ.TRAN_TIME 
              , PQ.QC_TYPE 
              , PQ.MAT_ID 
              , PQ.LOT_ID 
              , PQ.RES_ID, PQ.QC_FLAG, PQ.QC_OPERATOR 
              , WI.QTY_1  
              , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY='HMVA2' AND TABLE_NAME = 'H_CUSTOMER' AND KEY_1 = PQ.CUSTOMER AND ROWNUM=1), '-')  AS CUSTOMER 
              , TRIM(STS.LOT_CMF_7) AS ASSE_SITE, PQ.LEAD_COUNT, PQ.H_PACKAGE, PQ.DENSITY, PQ.SAMPLE_QTY, PQ.TOTAL_DEFECT_QTY_1, CMF_2 
              , DECODE(PQ.SAMPLE_QTY,0,0,ROUND((((PQ.TOTAL_DEFECT_QTY_1)/(PQ.SAMPLE_QTY))*1000000),0)) PPM   
              , NVL((SELECT CHAR_ID 
                       FROM MEDCLOTDAT 
                      WHERE  1=1  
                             AND COL_SET_ID IN ( 
                                                SELECT COL_SET_ID 
                                                  FROM MEDCCOLDEF 
                                                 WHERE 1=1 
                                                       AND COL_GRP_10='Visual' 
                                                       AND DELETE_FLAG <> 'Y' 
                                                      AND FACTORY=PQ.FACTORY 
                                                )  
                              AND LOT_ID = WI.LOT_ID 
                              AND VALUE_1 <> ' ' 
                              AND HIST_SEQ= PQ.HIST_SEQ 
                              AND ROWNUM = 1 ) 
                      ,'-') AS CHAR_ID  
         FROM CPQCLOTHIS@RPTTOMES PQ  
              , MWIPLOTHIS@RPTTOMES WI  
              , MWIPMATDEF MAT   
              , MWIPLOTSTS STS   
        WHERE 1 = 1 
              AND PQ.FACTORY = WI.FACTORY 
              AND PQ.FACTORY = MAT.FACTORY  
              AND PQ.MAT_ID = WI.MAT_ID  
              AND PQ.MAT_ID = MAT.MAT_ID  
              AND PQ.LOT_ID = WI.LOT_ID 
              AND PQ.LOT_ID = STS.LOT_ID 
              AND STS.LOT_CMF_7 LIKE '%'
              AND PQ.HIST_SEQ = WI.HIST_SEQ  
              AND MAT.FACTORY (+) = 'HMVA2' 
              AND WI.HIST_DEL_FLAG = ' ' 
              AND PQ.TRAN_TIME  BETWEEN '20200310220000' AND '20200511215959'  
              AND PQ.CMF_10 = ' ' 
     ) 
GROUP BY   ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' , QC_OPER, TRAN_TIME, QC_TYPE, MAT_ID, LOT_ID, RES_ID, QTY_1, CUSTOMER, ASSE_SITE, LEAD_COUNT, H_PACKAGE, DENSITY, QC_OPERATOR, SAMPLE_QTY, PPM, CMF_2, QC_FLAG 
ORDER BY   ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' , QC_OPER, TRAN_TIME, QC_TYPE, MAT_ID, LOT_ID, RES_ID, QTY_1, CUSTOMER, ASSE_SITE, LEAD_COUNT, H_PACKAGE, DENSITY, QC_OPERATOR, SAMPLE_QTY, PPM, CMF_2, QC_FLAG 

-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT PLAN_WEEK V1    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_DATE = TO_CHAR(SYSDATE,'yyyymmdd')      AND ROWNUM = 1  
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD010423'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT A.OPER_GRP, (SELECT TO_NUMBER(DATA_1) FROM MGCMTBLDAT WHERE FACTORY = 'HMVA2' AND TABLE_NAME = 'H_OPER_GRP_TARGET' AND KEY_1 = A.OPER_GRP) AS TARGET,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' 
     , B.GUBUN
     , ROUND(SUM(CASE WHEN B.GUBUN = '재공' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN WIP_0 ELSE WIP_0 / 1000 END) 
                      WHEN B.GUBUN = '실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN END_0 ELSE END_0 / 1000 END) 
                      WHEN B.GUBUN = '예상실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN EXP_0 ELSE EXP_0 / 1000 END) 
                      WHEN B.GUBUN = '설비대수' THEN RES_0
                      WHEN B.GUBUN = 'RUN' THEN RUN_0
                 END), 0) AS D0
     , ROUND(SUM(CASE WHEN B.GUBUN = '재공' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN WIP_1 ELSE WIP_1 / 1000 END) 
                      WHEN B.GUBUN = '실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN END_1 ELSE END_1 / 1000 END) 
                      WHEN B.GUBUN = '예상실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN EXP_1 ELSE EXP_1 / 1000 END) 
                      WHEN B.GUBUN = '설비대수' THEN RES_1
                      WHEN B.GUBUN = 'RUN' THEN RUN_1
                 END), 0) AS D1
     , ROUND(SUM(CASE WHEN B.GUBUN = '재공' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN WIP_TTL ELSE WIP_TTL / 1000 END)
                      WHEN B.GUBUN = '실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN END_TTL ELSE END_TTL / 1000 END)
                      WHEN B.GUBUN = '예상실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN EXP_TTL ELSE EXP_TTL / 1000 END)
                      WHEN B.GUBUN = '설비대수' THEN RES_TTL
                      WHEN B.GUBUN = 'RUN' THEN RUN_TTL
                 END), 0) AS TTL
     , ROUND(SUM(CASE WHEN B.GUBUN = '재공' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN WIP_TTL ELSE WIP_TTL / 1000 END)
                      WHEN B.GUBUN = '실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN END_TTL ELSE END_TTL / 1000 END)
                      WHEN B.GUBUN = '예상실적' THEN (CASE WHEN A.OPER_GRP IN ('STOCK', 'LAMI', 'Stealth Saw', 'BG', 'DDS', 'SAW') THEN EXP_TTL ELSE EXP_TTL / 1000 END)
                      WHEN B.GUBUN = '설비대수' THEN RES_TTL
                      WHEN B.GUBUN = 'RUN' THEN RUN_TTL
                 END) / 2, 0) AS AVG
  FROM (
        SELECT *
          FROM (
                SELECT *
                  FROM (
                        SELECT A.*
                             , B.*
                             , NVL((SELECT DATA_10 FROM MGCMTBLDAT WHERE TABLE_NAME = 'H_CUSTOMER' AND FACTORY = 'HMVA2' AND  KEY_1 = B.MAT_GRP_1), '-') AS CUST_TYPE
                             , (SELECT KEY_3 FROM MGCMTBLDAT WHERE FACTORY = 'HMVA2' AND TABLE_NAME = 'H_PKG_2D_CMOLD' AND KEY_1 = 'C-MOLD' AND KEY_2 = B.MAT_GRP_1 AND KEY_3 = B.MAT_CMF_11 AND (KEY_4 = '%' OR KEY_4 = B.MAT_ID)) AS KEY_3
                          FROM (
                                SELECT DECODE(LEVEL, 1, 'STOCK', 2, 'LAMI', 3, 'Stealth Saw', 4, 'BG', 5, 'DDS', 6, 'SAW', 7, 'DA(Epoxy)', 8, 'DA(DFN)', 9, 'WB', 10, 'C-MOLD', 11, 'SST', 12, 'HMK3') AS OPER_GRP
                                  FROM DUAL CONNECT BY LEVEL <= 12 
                               ) A 
                             , MWIPMATDEF B 
                         WHERE B.FACTORY = 'HMVA2'
                           AND B.MAT_TYPE = 'FG'
                           AND B.DELETE_FLAG = ' '
                       )
                 WHERE (OPER_GRP <> 'C-MOLD' OR KEY_3 IS NOT NULL)
               ) MAT
             , (
                SELECT MAT_ID AS END_MAT_ID
                     , OPER_GRP AS END_OPER_GRP
                     , SUM(CONV_END_QTY) AS END_TTL
                     , SUM(DECODE(WORK_DATE, '20200511', 0, CONV_END_QTY)) + (SUM(DECODE(WORK_DATE, '20200511', CONV_END_QTY , 0)) / 16.2156950395278 * 24) AS EXP_TTL
                     , SUM(DECODE(WORK_DATE, '20200510', CONV_END_QTY, 0)) AS END_0
                     , SUM(DECODE(WORK_DATE, '20200511', CONV_END_QTY, 0)) AS END_1
                     , SUM(DECODE(WORK_DATE, '20200510', CONV_END_QTY, 0)) AS EXP_0
                     , SUM(DECODE(WORK_DATE, '20200511', CONV_END_QTY, 0)) / 16.2156950395278 * 24 AS EXP_1
                  FROM (
                        SELECT A.MAT_ID
                             , A.WORK_DATE
                             , CASE WHEN A.OPER = 'A0033' THEN 'Stealth Saw'
                                    WHEN A.OPER IN ('A0040', 'A0030') THEN 'BG'
                                    WHEN A.OPER = 'A0230' THEN 'DDS'
                                    WHEN A.OPER = 'A1000' THEN 'C-MOLD'
                                    WHEN A.OPER LIKE 'A060%' THEN 'WB'
                                    WHEN A.OPER IN ('A1750', 'A1825') THEN 'SST'
                                    WHEN A.OPER = 'A0200' THEN 'SAW'
                                    WHEN A.OPER LIKE 'A040%' AND B.MAT_GRP_2 = 'DFN' THEN 'DA(DFN)'
                                    WHEN A.OPER LIKE 'A040%' AND E.DA_TYPE = 'Epoxy' THEN 'DA(Epoxy)'
                                    WHEN A.OPER = 'A0000' THEN 'STOCK'
                                    WHEN A.OPER = 'A0020' THEN 'LAMI'
                                    WHEN A.OPER = 'AZ010' THEN 'HMK3'
                                    ELSE ''
                               END OPER_GRP
                             , CASE WHEN A.OPER = 'AZ010' THEN DECODE(B.MAT_GRP_3, 'COB', 0, 'BGN', 0, (S1_MOVE_QTY_1+S2_MOVE_QTY_1+S3_MOVE_QTY_1))
                                    WHEN A.OPER = 'A0000' THEN (S1_OPER_IN_QTY_1+S2_OPER_IN_QTY_1+S3_OPER_IN_QTY_1)
                                    ELSE (S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1)
                               END AS END_QTY
                             , CASE WHEN A.OPER = 'A0000' THEN (S1_OPER_IN_QTY_2+S2_OPER_IN_QTY_2+S3_OPER_IN_QTY_2)
                                    WHEN A.OPER IN ('A0033', 'A0040', 'A0230', 'A0030', 'A0200', 'A0020') THEN (S1_END_QTY_2+S2_END_QTY_2+S3_END_QTY_2)
                                    WHEN A.OPER LIKE 'A040%' AND B.MAT_ID LIKE 'SEK%' THEN (S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1) * NVL(C.DATA_1,1)
                                    WHEN A.OPER LIKE 'A040%' AND (B.MAT_GRP_5 IN ('1st', 'Merge') OR B.MAT_GRP_5 LIKE 'Middle%') THEN (S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1) * NVL(C.DATA_1,1)
                                    WHEN A.OPER LIKE 'A060%' THEN (S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1) * (CASE WHEN D.WIRE_CNT IS NOT NULL THEN D.WIRE_CNT
                                                                                           WHEN B.MAT_GRP_6 NOT IN ('-','0') THEN B.MAT_GRP_6
                                                                                           ELSE '1' END)
                                    WHEN A.OPER = 'AZ010' THEN DECODE(B.MAT_GRP_3, 'COB', 0, 'BGN', 0, (S1_MOVE_QTY_1+S2_MOVE_QTY_1+S3_MOVE_QTY_1))
                                    ELSE (S1_END_QTY_1+S2_END_QTY_1+S3_END_QTY_1)
                               END AS CONV_END_QTY
                          FROM RSUMWIPMOV A
                             , MWIPMATDEF B
                             , (
                                SELECT KEY_1 AS MAT_ID, DATA_1
                                  FROM MGCMTBLDAT 
                                 WHERE FACTORY = 'HMVA2'
                                   AND TABLE_NAME IN ('H_SEC_AUTO_LOSS','H_HX_AUTO_LOSS')
                               ) C
                             , (
                                SELECT MAT_ID, OPER, TCD_CMF_2 AS WIRE_CNT
                                  FROM CWIPTCDDEF@RPTTOMES 
                                 WHERE FACTORY = 'HMVA2'
                                   AND OPER LIKE 'A060%'
                                   AND SET_FLAG = 'Y'
                                   AND TCD_CMF_2 <> ' '
                               ) D
                             , (
                                SELECT KEY_1 AS MAT_GRP_2, DATA_2 AS DA_TYPE
                                  FROM MGCMTBLDAT 
                                 WHERE FACTORY = 'HMVA2'
                                   AND TABLE_NAME = 'H_FAMILY'
                               ) E
                         WHERE 1=1
                           AND A.FACTORY = B.FACTORY
                           AND A.MAT_ID = B.MAT_ID
                           AND A.MAT_ID = C.MAT_ID(+)
                           AND A.MAT_ID = D.MAT_ID(+)
                           AND A.OPER = D.OPER(+)
                           AND B.MAT_GRP_2 = E.MAT_GRP_2(+)
                           AND A.FACTORY = 'HMVA2'
                           AND A.WORK_DATE BETWEEN '20200510' AND '20200511'
                           AND A.LOT_TYPE = 'W'
                           AND B.DELETE_FLAG = ' '
                           AND B.MAT_TYPE = 'FG'
                           AND A.FACTORY NOT IN ('RETURN') 
                           AND A.CM_KEY_3 LIKE 'P%' 
                           AND REGEXP_LIKE(A.OPER, 'A040*|A0033|A0040|A0230|A1000|A060*|A1750|A0030|A0000|A0020|AZ010|A1825|A0200')
                       )
                 GROUP BY MAT_ID, OPER_GRP
               ) SHP
             , (
                SELECT MAT_ID AS WIP_MAT_ID
                     , OPER_GRP AS WIP_OPER_GRP
                     , SUM(CONV_WIP_QTY) AS WIP_TTL
                     , SUM(DECODE(WORK_DATE, '20200510', CONV_WIP_QTY, 0)) AS WIP_0
                     , SUM(DECODE(WORK_DATE, '20200511', CONV_WIP_QTY, 0)) AS WIP_1
                  FROM (
                        SELECT A.MAT_ID, WORK_DATE
                             , CASE WHEN A.OPER = 'A0033' THEN 'Stealth Saw'
                                    WHEN A.OPER IN ('A0040', 'A0030') THEN 'BG'
                                    WHEN A.OPER = 'A0230' THEN 'DDS'
                                    WHEN A.OPER IN ('A1000', 'A0950') THEN 'C-MOLD'
                                    WHEN A.OPER LIKE 'A060%' OR A.OPER LIKE 'A055%' THEN 'WB'
                                    WHEN A.OPER IN ('A1750', 'A1825') THEN 'SST'
                                    WHEN A.OPER = 'A0200' THEN 'SAW'
                                    WHEN (A.OPER LIKE 'A040%' OR A.OPER = 'A0250') AND B.MAT_GRP_2 = 'DFN' THEN 'DA(DFN)'
                                    WHEN (A.OPER LIKE 'A040%' OR A.OPER = 'A0250') AND B.DA_TYPE = 'Epoxy' THEN 'DA(Epoxy)'
                                    WHEN A.OPER = 'A0000' THEN 'STOCK'
                                    WHEN A.OPER = 'A0020' THEN 'LAMI'
                                    WHEN A.OPER = 'AZ010' THEN 'HMK3'
                                    ELSE ''
                               END OPER_GRP
                             , CASE WHEN A.OPER IN ('A0033', 'A0040', 'A0030', 'A0230', 'A0200', 'A0000', 'A0020') THEN WIP_QTY
                                    WHEN B.GUBUN = 'O' THEN WIP_QTY
                                    ELSE 0
                               END WIP_QTY
                             , CASE WHEN A.OPER IN ('A0033', 'A0040', 'A0030', 'A0230', 'A0200', 'A0000', 'A0020') THEN WIP_QTY_2
                                    WHEN A.OPER LIKE 'A040%' AND B.GUBUN = 'O' THEN WIP_QTY * COMP_CNT
                                    WHEN A.OPER LIKE 'A060%' AND B.GUBUN = 'O' THEN WIP_QTY * (CASE WHEN C.WIRE_CNT IS NOT NULL THEN C.WIRE_CNT
                                                                                                    WHEN B.MAT_GRP_6 NOT IN ('-','0') THEN B.MAT_GRP_6
                                                                                                    ELSE '1' END)
                                    WHEN B.GUBUN = 'O' THEN WIP_QTY
                                    ELSE 0
                               END AS CONV_WIP_QTY
                          FROM (
                                SELECT MAT_ID
                                     , '20200511' AS WORK_DATE
                                     , OPER
                                     , QTY_1 AS WIP_QTY
                                     , QTY_2 AS WIP_QTY_2
                                  FROM RWIPLOTSTS
                                 WHERE FACTORY = 'HMVA2'
                                   AND LOT_TYPE = 'W'
                                   AND LOT_DEL_FLAG = ' '
                                   AND REGEXP_LIKE(OPER, 'A040*|A0033|A0040|A0230|A1000|A0950|A060*|A1750|A0030|A0200|A0000|A0020|AZ010|A0250|A050*|A053*|A055*|A1825') 
                                   AND LOT_CMF_5 LIKE 'P%' 
                                 UNION ALL
                                SELECT MAT_ID
                                     , WORK_DATE
                                     , OPER
                                     , EOH_QTY_1 AS WIP_QTY
                                     , EOH_QTY_2 AS WIP_QTY_2
                                  FROM RSUMWIPEOH
                                 WHERE FACTORY = 'HMVA2'
                                   AND LOT_TYPE = 'W'
                                   AND REGEXP_LIKE(OPER, 'A040*|A0033|A0040|A0230|A1000|A0950|A060*|A1750|A0030|A0200|A0000|A0020|AZ010|A0250|A050*|A053*|A055*|A1825')
                                   AND WORK_DATE BETWEEN '20200510' AND '20200510'
                                   AND SHIFT = '3'
                                   AND CM_KEY_3 LIKE 'P%' 
                               ) A
                             , (
                                SELECT *
                                  FROM (
                                        SELECT MAT_ID, MAT_GRP_2, MAT_GRP_4, MAT_GRP_5, MAT_GRP_6, MAT_CMF_11
                                             , CASE WHEN MAT_GRP_4 NOT IN ('-','FD','FU') AND MAT_GRP_5 <> '-'
                                                         THEN (CASE WHEN MAT_GRP_5 IN ('1st','Merge') OR MAT_GRP_5 LIKE 'Middle%' THEN 'O' ELSE '' END)
                                                    WHEN MAT_GRP_4 NOT IN ('-','FD','FU') AND MAT_GRP_5 = '-' THEN '' 
                                                    ELSE 'O'
                                               END GUBUN
                                             , (SELECT DATA_2 FROM MGCMTBLDAT WHERE FACTORY = 'HMVA2' AND TABLE_NAME = 'H_FAMILY' AND KEY_1 = MAT_GRP_2) AS DA_TYPE
                                             , COMP_CNT
                                          FROM VWIPMATDEF
                                         WHERE FACTORY = 'HMVA2'
                                           AND MAT_TYPE = 'FG'
                                           AND DELETE_FLAG = ' '
                                           AND MAT_GRP_2 <> '-'
                                       )
                               ) B
                             , (
                                SELECT MAT_ID, OPER, TCD_CMF_2 AS WIRE_CNT
                                  FROM CWIPTCDDEF@RPTTOMES
                                 WHERE FACTORY = 'HMVA2'
                                   AND OPER LIKE 'A060%'
                                   AND SET_FLAG = 'Y'
                                   AND TCD_CMF_2 <> ' '
                               ) C
                         WHERE A.MAT_ID = B.MAT_ID
                           AND A.MAT_ID = C.MAT_ID(+)
                           AND A.OPER = C.OPER(+)
                       )
                 GROUP BY MAT_ID, OPER_GRP
               ) WIP
             , (
                SELECT RES_STS_2 AS RES_MAT_ID
                     , OPER_GRP AS RES_OPER_GRP 
                     , SUM(RES_CNT) AS RES_TTL
                     , SUM(RUN_CNT) AS RUN_TTL
                     , SUM(DECODE(WORK_DATE, '20200510', RES_CNT, 0)) AS RES_0
                     , SUM(DECODE(WORK_DATE, '20200511', RES_CNT, 0)) AS RES_1
                     , SUM(DECODE(WORK_DATE, '20200510', RUN_CNT, 0)) AS RUN_0
                     , SUM(DECODE(WORK_DATE, '20200511', RUN_CNT, 0)) AS RUN_1
                  FROM (
                        SELECT RES_STS_2
                             , WORK_DATE
                             , CASE WHEN A.RES_GRP_3 = 'SDBG' THEN 'Stealth Saw'
                                    WHEN A.RES_GRP_3 = 'BACK LAP' THEN 'BG'
                                    WHEN A.RES_GRP_3 = 'WAFER EXPANDING' THEN 'DDS'
                                    WHEN A.RES_GRP_3 = 'MOLD' THEN 'C-MOLD'
                                    WHEN A.RES_GRP_3 = 'WIRE BOND' THEN 'WB'
                                    WHEN A.RES_GRP_3 = 'SAW SORTER' THEN 'SST'
                                    WHEN A.RES_GRP_3 = 'SAW' THEN 'SAW'
                                    WHEN A.RES_GRP_3 = 'DIE ATTACH' AND B.MAT_GRP_2 = 'DFN' THEN 'DA(DFN)'
                                    WHEN A.RES_GRP_3 = 'DIE ATTACH' AND REGEXP_LIKE(A.RES_GRP_6, 'ESEC2100SD|SDB-30UST|^DB*|^SPA*') THEN 'DA(Epoxy)'
                                    WHEN A.RES_GRP_3 = 'LAMINATION' THEN 'LAMI'
                                    ELSE 'DA'
                               END OPER_GRP
                             , RES_CNT
                             , RUN_CNT
                          FROM (
                                SELECT A.RES_STS_2
                                     , '20200511' AS WORK_DATE
                                     , A.RES_GRP_3
                                     , A.RES_GRP_6
                                     , COUNT(A.RES_ID) AS RES_CNT
                                     , NVL(SUM(DECODE(RES_UP_DOWN_FLAG, 'U', DECODE(NVL(B.START_RES_ID, '-'), '-', 0, 1))), 0) AS RUN_CNT
                                  FROM MRASRESDEF A
                                     , (
                                        SELECT DISTINCT START_RES_ID
                                          FROM MWIPLOTSTS
                                         WHERE FACTORY = 'HMVA2'
                                           AND LOT_TYPE = 'W'
                                           AND LOT_DEL_FLAG = ' '
                                           AND LOT_CMF_5 LIKE 'P%' 
                                           AND REGEXP_LIKE(OPER, 'A040*|A0033|A0040|A0230|A1000|A060*|A1750|A0030|A0200|A0020|A1825')
                                           AND LOT_STATUS = 'PROC'
                                       ) B
                                 WHERE 1=1
                                   AND A.RES_ID = B.START_RES_ID(+)
                                   AND A.FACTORY = 'HMVA2'
                                   AND A.RES_CMF_9 = 'Y'
                                   AND A.RES_CMF_7 = 'Y'
                                   AND (A.RES_STS_1 NOT IN ('C200', 'B199') OR A.RES_UP_DOWN_FLAG = 'U') 
                                   AND A.DELETE_FLAG  = ' '
                                   AND A.RES_TYPE  = 'EQUIPMENT'
                                   AND (A.RES_GRP_3 IN ('SDBG','BACK LAP','WAFER EXPANDING','DIE ATTACH', 'WIRE BOND', 'SAW SORTER', 'SAW', 'LAMINATION') OR A.RES_ID IN ('M-A57','M-A59','M-A60'))
                                 GROUP BY A.RES_STS_2, A.RES_GRP_3, A.RES_GRP_6
                                 UNION ALL
                                SELECT RES_STS_2
                                     , SUBSTR(CUTOFF_DT, 1, 8) AS WORK_DATE
                                     , RES_GRP_3
                                     , RES_GRP_6
                                     , COUNT(RES_ID) AS RES_CNT
                                     , SUM(DECODE(RES_UP_DOWN_FLAG, 'U', 1, 0)) AS RUN_CNT
                                  FROM MRASRESDEF_BOH
                                 WHERE FACTORY = 'HMVA2'
                                   AND CUTOFF_DT BETWEEN '2020051022' AND '2020051022'
                                   AND SUBSTR(CUTOFF_DT, -2) = '22'
                                   AND RES_CMF_9 = 'Y'
                                   AND RES_CMF_7 = 'Y'
                                   AND (RES_STS_1 NOT IN ('C200', 'B199') OR RES_UP_DOWN_FLAG = 'U') 
                                   AND DELETE_FLAG  = ' '
                                   AND RES_TYPE  = 'EQUIPMENT'
                                   AND (RES_GRP_3 IN ('SDBG','BACK LAP','WAFER EXPANDING','DIE ATTACH', 'WIRE BOND', 'SAW SORTER', 'SAW', 'LAMINATION') OR RES_ID IN ('M-A57','M-A59','M-A60'))
                                 GROUP BY RES_STS_2, SUBSTR(CUTOFF_DT, 1, 8), RES_GRP_3, RES_GRP_6
                               ) A
                             , (
                                SELECT MAT_ID, MAT_GRP_2
                                     , (SELECT DATA_2 FROM MGCMTBLDAT WHERE FACTORY = 'HMVA2' AND TABLE_NAME = 'H_FAMILY' AND KEY_1 = MAT_GRP_2) AS DA_TYPE
                                  FROM MWIPMATDEF
                                 WHERE FACTORY = 'HMVA2'
                                   AND MAT_TYPE = 'FG'
                               ) B
                 WHERE A.RES_STS_2 = B.MAT_ID(+)
                       )
                 GROUP BY RES_STS_2, OPER_GRP
               ) RES
         WHERE 1=1
           AND MAT.OPER_GRP = SHP.END_OPER_GRP(+)
           AND MAT.OPER_GRP = WIP.WIP_OPER_GRP(+)
           AND MAT.OPER_GRP = RES.RES_OPER_GRP(+)
           AND MAT.MAT_ID = SHP.END_MAT_ID(+)
           AND MAT.MAT_ID = WIP.WIP_MAT_ID(+)
           AND MAT.MAT_ID = RES.RES_MAT_ID(+)
           AND NVL(SHP.END_TTL,0) + NVL(WIP.WIP_TTL,0) + NVL(RES.RES_TTL,0) > 0
       ) A
     , (SELECT DECODE(LEVEL, 1, '재공', 2, '실적', 3, '예상실적', 4, '설비대수', 5, 'RUN') AS GUBUN FROM DUAL CONNECT BY LEVEL <= 5 ) B
 GROUP BY A.OPER_GRP, A.OPER_GRP,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', B.GUBUN 
 ORDER BY DECODE(A.OPER_GRP, 'STOCK', 1, 'LAMI', 2, 'Stealth Saw', 3, 'BG', 4, 'DDS', 5, 'SAW', 6, 'DA', 7, 'DA(Epoxy)', 8, 'DA(DFN)', 9, 'WB', 10, 'C-MOLD', 11, 'SST', 12, 13), A.OPER_GRP,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', DECODE(B.GUBUN, '재공', 1, '실적', 2, '예상실적', 3, '설비대수', 4, 5) 

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM','HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM','HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM','HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT PLAN_WEEK V1    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('HM', 'SYSTEM')     AND SYS_DATE = TO_CHAR(SYSDATE,'yyyymmdd')      AND ROWNUM = 1  
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM','HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM','HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT PLAN_WEEK V1    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_DATE = TO_CHAR(SYSDATE,'yyyymmdd')      AND ROWNUM = 1  
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
 SELECT UNIQUE PLAN_WEEK V1, (PLAN_YEAR || LPAD(PLAN_WEEK, 2,'0')) V2    FROM MWIPCALDEF   WHERE CALENDAR_ID IN ('SYSTEM', 'HM', 'SYSTEM')     AND SYS_YEAR = NVL('2020', TO_CHAR(SYSDATE,'yyyy'))    ORDER BY 1 
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'RAS020208'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT FACTORY Code, FAC_DESC Data
  FROM MWIPFACDEF
 WHERE FAC_GRP_5 = 'Y' 
 ORDER BY FAC_GRP_4 ASC
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,8640)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,8640)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,8640)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,8640)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,8640)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,8640)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,8640)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,8640)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,8640)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,8640))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,8640),'', 8640, NVL(MOV.RUN_TIME,8640)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,8640)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,8640)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200504220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200505' AND '20200510' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200505' AND '20200510'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 8640 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200505' AND '20200510'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200504220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,978)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,978)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,978)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,978)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,978)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,978)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,978)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,978)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,978)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,978))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,978),'', 978, NVL(MOV.RUN_TIME,978)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,978)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,978)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200510220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200511' AND '20200511' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200511' AND '20200511'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 978 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200511' AND '20200511'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200510220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,1440)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,1440))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,1440),'', 1440, NVL(MOV.RUN_TIME,1440)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,1440)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200503220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200504' AND '20200504' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200504' AND '20200504'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 1440 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200504' AND '20200504'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200503220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,1440)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,1440))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,1440),'', 1440, NVL(MOV.RUN_TIME,1440)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,1440)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200430220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200501' AND '20200501' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200501' AND '20200501'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 1440 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200501' AND '20200501'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200430220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
SELECT MIN(SYS_DATE) AS START_DAY 
     , MAX(SYS_DATE) AS END_DAY 
     , PLAN_YEAR||DECODE(LENGTH(PLAN_WEEK), 1, '0'||PLAN_WEEK, PLAN_WEEK) AS WEEK
  FROM MWIPCALDEF 
 WHERE CALENDAR_ID = 'OTD'
   AND (PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) IN ( 
                                                SELECT WW
                                                  FROM (
                                                        SELECT WW
                                                             , ROW_NUMBER() OVER(ORDER BY WW) AS RNK
                                                          FROM (
                                                                SELECT DISTINCT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW
                                                                  FROM MWIPCALDEF
                                                                 WHERE CALENDAR_ID = 'OTD'
                                                                   AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') >= (
                                                                                                              SELECT MAX(PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) AS WW
                                                                                                                FROM MWIPCALDEF
                                                                                                               WHERE CALENDAR_ID = 'OTD'
                                                                                                                 AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') < (SELECT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD' AND SYS_DATE = '20200511')
                                                                                                                 AND SYS_DATE >= TO_CHAR(TO_DATE('20200511', 'YYYYMMDD')-14, 'YYYYMMDD')
                                                                                                             )
                                                               ) 
                                                       )
                                                 WHERE RNK <= 7
                                               ) 
 GROUP BY PLAN_YEAR, PLAN_WEEK 
 ORDER BY PLAN_YEAR, PLAN_WEEK

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT MIN(SYS_DATE) AS START_DAY 
     , MAX(SYS_DATE) AS END_DAY 
     , PLAN_YEAR||DECODE(LENGTH(PLAN_WEEK), 1, '0'||PLAN_WEEK, PLAN_WEEK) AS WEEK
  FROM MWIPCALDEF 
 WHERE CALENDAR_ID = 'SE'
   AND (PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) IN ( 
                                                SELECT WW
                                                  FROM (
                                                        SELECT WW
                                                             , ROW_NUMBER() OVER(ORDER BY WW) AS RNK
                                                          FROM (
                                                                SELECT DISTINCT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW
                                                                  FROM MWIPCALDEF
                                                                 WHERE CALENDAR_ID = 'SE'
                                                                   AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') >= (
                                                                                                              SELECT MAX(PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) AS WW
                                                                                                                FROM MWIPCALDEF
                                                                                                               WHERE CALENDAR_ID = 'SE'
                                                                                                                 AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') < (SELECT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW FROM MWIPCALDEF WHERE CALENDAR_ID = 'SE' AND SYS_DATE = '20200511')
                                                                                                                 AND SYS_DATE >= TO_CHAR(TO_DATE('20200511', 'YYYYMMDD')-14, 'YYYYMMDD')
                                                                                                             )
                                                               ) 
                                                       )
                                                 WHERE RNK <= 7
                                               ) 
 GROUP BY PLAN_YEAR, PLAN_WEEK 
 ORDER BY PLAN_YEAR, PLAN_WEEK

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD010216'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,1440)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,1440))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,1440),'', 1440, NVL(MOV.RUN_TIME,1440)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,1440)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200425220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200426' AND '20200426' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200426' AND '20200426'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 1440 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200426' AND '20200426'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200425220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT MIN(SYS_DATE) AS START_DAY 
     , MAX(SYS_DATE) AS END_DAY 
     , PLAN_YEAR||DECODE(LENGTH(PLAN_WEEK), 1, '0'||PLAN_WEEK, PLAN_WEEK) AS WEEK
  FROM MWIPCALDEF 
 WHERE CALENDAR_ID = 'OTD'
   AND (PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) IN ( 
                                                SELECT WW
                                                  FROM (
                                                        SELECT WW
                                                             , ROW_NUMBER() OVER(ORDER BY WW) AS RNK
                                                          FROM (
                                                                SELECT DISTINCT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW
                                                                  FROM MWIPCALDEF
                                                                 WHERE CALENDAR_ID = 'OTD'
                                                                   AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') >= (
                                                                                                              SELECT MAX(PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) AS WW
                                                                                                                FROM MWIPCALDEF
                                                                                                               WHERE CALENDAR_ID = 'OTD'
                                                                                                                 AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') < (SELECT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD' AND SYS_DATE = '20200511')
                                                                                                                 AND SYS_DATE >= TO_CHAR(TO_DATE('20200511', 'YYYYMMDD')-14, 'YYYYMMDD')
                                                                                                             )
                                                               ) 
                                                       )
                                                 WHERE RNK <= 7
                                               ) 
 GROUP BY PLAN_YEAR, PLAN_WEEK 
 ORDER BY PLAN_YEAR, PLAN_WEEK

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT MIN(SYS_DATE) AS START_DAY 
     , MAX(SYS_DATE) AS END_DAY 
     , PLAN_YEAR||DECODE(LENGTH(PLAN_WEEK), 1, '0'||PLAN_WEEK, PLAN_WEEK) AS WEEK
  FROM MWIPCALDEF 
 WHERE CALENDAR_ID = 'SE'
   AND (PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) IN ( 
                                                SELECT WW
                                                  FROM (
                                                        SELECT WW
                                                             , ROW_NUMBER() OVER(ORDER BY WW) AS RNK
                                                          FROM (
                                                                SELECT DISTINCT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW
                                                                  FROM MWIPCALDEF
                                                                 WHERE CALENDAR_ID = 'SE'
                                                                   AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') >= (
                                                                                                              SELECT MAX(PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) AS WW
                                                                                                                FROM MWIPCALDEF
                                                                                                               WHERE CALENDAR_ID = 'SE'
                                                                                                                 AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') < (SELECT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW FROM MWIPCALDEF WHERE CALENDAR_ID = 'SE' AND SYS_DATE = '20200511')
                                                                                                                 AND SYS_DATE >= TO_CHAR(TO_DATE('20200511', 'YYYYMMDD')-14, 'YYYYMMDD')
                                                                                                             )
                                                               ) 
                                                       )
                                                 WHERE RNK <= 7
                                               ) 
 GROUP BY PLAN_YEAR, PLAN_WEEK 
 ORDER BY PLAN_YEAR, PLAN_WEEK

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT CUSTOMER,  ' ', MAT_GRP_2, MAT_GRP_3, MAT_GRP_4,  ' ', MAT_GRP_6,  ' ',  ' ',  ' ', CONV_MAT_ID,  ' ',  ' ',  ' ' 
     , WEEK_PLAN, SHP_WEEK, WEEK_DEF, REMAIN_MOLD, REMAIN_WB, REMAIN_DA, REMAIN_BG, REMAIN_INPUT, REMAIN_WF, DA_CAPA, WB_CAPA
     , D0_PLAN2, D0_DEF, SHP_TODAY, HMK3A, QC_GATE, PVI, BAKE, AVI, DC2, DC1, SIG, SBA, TRIM, MK, TIN, CURE, MOLD, PLASMA, GATE
     , WB9, DA9, WB8, DA8, WB7, DA7, WB6, DA6, WB5, DA5, WB4, DA4, WB3, DA3, WB2, DA2, WB1, DA1, SP, SAW, BG, HMK2A
     , D0_PLAN, D1_PLAN, D2_PLAN, D3_PLAN, D4_PLAN, DA1_CAPA, WB1_CAPA, DA2_CAPA, WB2_CAPA, DA3_CAPA, WB3_CAPA, DA4_CAPA, WB4_CAPA, DA5_CAPA, WB5_CAPA
     , DA6_CAPA, WB6_CAPA, DA7_CAPA, WB7_CAPA, DA8_CAPA, WB8_CAPA, DA9_CAPA, WB9_CAPA, WEEK2_PLAN, WEEK3_PLAN, WEEK4_PLAN, WEEK5_PLAN, ORI_PLAN, SHP_MONTH, MONTH_DEF, REV_PLAN, PER
  FROM(
SELECT (SELECT DATA_1 FROM MGCMTBLDAT WHERE TABLE_NAME = 'H_CUSTOMER' AND KEY_1 = MAT.MAT_GRP_1 AND ROWNUM=1) AS CUSTOMER,  ' ', MAT.MAT_GRP_2, MAT.MAT_GRP_3, MAT.MAT_GRP_4,  ' ', MAT.MAT_GRP_6,  ' ',  ' ',  ' ', MAT.CONV_MAT_ID,  ' ',  ' ',  ' ' 
     , ROUND(SUM(NVL(WEEK1_PLAN, 0)) / 1, 0) AS WEEK_PLAN
     , ROUND(SUM(NVL(SHP_WEEK, 0)) / 1, 0) AS SHP_WEEK
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0)) / 1, 0) AS WEEK_DEF
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0) - NVL(W_MOLD, 0)) / 1, 0) AS REMAIN_MOLD 
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0) - NVL(W_WB, 0)) / 1, 0) AS REMAIN_WB
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0) - NVL(W_DA, 0)) / 1, 0) AS REMAIN_DA
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0) - NVL(W_BG, 0)) / 1, 0) AS REMAIN_BG
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0) - NVL(W_ISSUE, 0)) / 1, 0) AS REMAIN_INPUT
     , ROUND(SUM(NVL(WEEK1_PLAN, 0) - NVL(SHP_WEEK, 0) - NVL(TOTAL, 0)) / 1, 0) AS REMAIN_WF
     , ROUND(SUM(NVL(DA_CAPA, 0)) / 1, 0) AS DA_CAPA
     , ROUND(SUM(NVL(WB_CAPA, 0)) / 1, 0) AS WB_CAPA
     , ROUND(SUM(NVL(D0_PLAN, 0) + (NVL(WEEK1_TTL, 0) - NVL(SHP_WEEK_TTL, 0))) / 1, 0) AS D0_PLAN2
     , ROUND(SUM(NVL(D0_PLAN, 0) + (NVL(WEEK1_TTL, 0) - NVL(SHP_WEEK_TTL, 0)) - NVL(SHP_TODAY, 0)) / 1, 0) AS D0_DEF
     , ROUND(SUM(NVL(SHP_TODAY, 0)) / 1, 0) AS SHP_TODAY
     , ROUND(SUM(NVL(WIP.HMK3A, 0)) / 1, 0) AS HMK3A
     , ROUND(SUM(NVL(WIP.QC_GATE, 0)) / 1, 0) AS QC_GATE
     , ROUND(SUM(NVL(WIP.PVI, 0)) / 1, 0) AS PVI
     , ROUND(SUM(NVL(WIP.BAKE,0)) / 1, 0) AS BAKE
     , ROUND(SUM(NVL(WIP.AVI,0)) / 1, 0) AS AVI
     , ROUND(SUM(NVL(WIP.DC2,0)) / 1, 0) AS DC2
     , ROUND(SUM(NVL(WIP.DC1,0)) / 1, 0) AS DC1
     , ROUND(SUM(NVL(WIP.SIG,0)) / 1, 0) AS SIG
     , ROUND(SUM(NVL(WIP.SBA,0)) / 1, 0) AS SBA
     , ROUND(SUM(NVL(WIP.TIN,0)) / 1, 0) AS TIN
     , ROUND(SUM(NVL(WIP.TRIM,0)) / 1, 0) AS TRIM
     , ROUND(SUM(NVL(WIP.MK,0)) / 1, 0) AS MK
     , ROUND(SUM(NVL(WIP.CURE,0)) / 1, 0) AS CURE
     , ROUND(SUM(NVL(WIP.MOLD,0)) / 1, 0) AS MOLD
     , ROUND(SUM(NVL(WIP.PLASMA,0)) / 1, 0) AS PLASMA
     , ROUND(SUM(NVL(WIP.GATE,0)) / 1, 0) AS GATE
     , ROUND(SUM(NVL(WIP.WB9,0)) / 1, 0) AS WB9
     , ROUND(SUM(NVL(WIP.DA9,0)) / 1, 0) AS DA9
     , ROUND(SUM(NVL(WIP.WB8,0)) / 1, 0) AS WB8
     , ROUND(SUM(NVL(WIP.DA8,0)) / 1, 0) AS DA8
     , ROUND(SUM(NVL(WIP.WB7,0)) / 1, 0) AS WB7
     , ROUND(SUM(NVL(WIP.DA7,0)) / 1, 0) AS DA7
     , ROUND(SUM(NVL(WIP.WB6,0)) / 1, 0) AS WB6
     , ROUND(SUM(NVL(WIP.DA6,0)) / 1, 0) AS DA6
     , ROUND(SUM(NVL(WIP.WB5,0)) / 1, 0) AS WB5
     , ROUND(SUM(NVL(WIP.DA5,0)) / 1, 0) AS DA5
     , ROUND(SUM(NVL(WIP.WB4,0)) / 1, 0) AS WB4
     , ROUND(SUM(NVL(WIP.DA4,0)) / 1, 0) AS DA4
     , ROUND(SUM(NVL(WIP.WB3,0)) / 1, 0) AS WB3
     , ROUND(SUM(NVL(WIP.DA3,0)) / 1, 0) AS DA3
     , ROUND(SUM(NVL(WIP.WB2,0)) / 1, 0) AS WB2
     , ROUND(SUM(NVL(WIP.DA2,0)) / 1, 0) AS DA2
     , ROUND(SUM(NVL(WIP.WB1,0)) / 1, 0) AS WB1
     , ROUND(SUM(NVL(WIP.DA1,0)) / 1, 0) AS DA1
     , ROUND(SUM(NVL(WIP.SP,0)) / 1, 0) AS SP
     , ROUND(SUM(NVL(WIP.SAW,0)) / 1, 0) AS SAW
     , ROUND(SUM(NVL(WIP.BG,0)) / 1, 0) AS BG
     , ROUND(SUM(NVL(WIP.HMK2A,0)) / 1, 0) AS HMK2A
     , ROUND(SUM(NVL(D0_PLAN, 0) + (NVL(WEEK1_TTL, 0) - NVL(SHP_WEEK_TTL, 0))) / 1, 0) AS D0_PLAN
     , ROUND(SUM(NVL(D1_PLAN, 0)) / 1, 0) AS D1_PLAN
     , ROUND(SUM(NVL(D2_PLAN, 0)) / 1, 0) AS D2_PLAN
     , ROUND(SUM(NVL(D3_PLAN, 0)) / 1, 0) AS D3_PLAN
     , ROUND(SUM(NVL(D4_PLAN, 0)) / 1, 0) AS D4_PLAN
     , ROUND(SUM(NVL(DA1_CAPA, 0)) / 1, 0) AS DA1_CAPA
     , ROUND(SUM(NVL(WB1_CAPA, 0)) / 1, 0) AS WB1_CAPA
     , ROUND(SUM(NVL(DA2_CAPA, 0)) / 1, 0) AS DA2_CAPA
     , ROUND(SUM(NVL(WB2_CAPA, 0)) / 1, 0) AS WB2_CAPA
     , ROUND(SUM(NVL(DA3_CAPA, 0)) / 1, 0) AS DA3_CAPA
     , ROUND(SUM(NVL(WB3_CAPA, 0)) / 1, 0) AS WB3_CAPA
     , ROUND(SUM(NVL(DA4_CAPA, 0)) / 1, 0) AS DA4_CAPA
     , ROUND(SUM(NVL(WB4_CAPA, 0)) / 1, 0) AS WB4_CAPA
     , ROUND(SUM(NVL(DA5_CAPA, 0)) / 1, 0) AS DA5_CAPA
     , ROUND(SUM(NVL(WB5_CAPA, 0)) / 1, 0) AS WB5_CAPA
     , ROUND(SUM(NVL(DA6_CAPA, 0)) / 1, 0) AS DA6_CAPA
     , ROUND(SUM(NVL(WB6_CAPA, 0)) / 1, 0) AS WB6_CAPA
     , ROUND(SUM(NVL(DA7_CAPA, 0)) / 1, 0) AS DA7_CAPA
     , ROUND(SUM(NVL(WB7_CAPA, 0)) / 1, 0) AS WB7_CAPA
     , ROUND(SUM(NVL(DA8_CAPA, 0)) / 1, 0) AS DA8_CAPA
     , ROUND(SUM(NVL(WB8_CAPA, 0)) / 1, 0) AS WB8_CAPA
     , ROUND(SUM(NVL(DA9_CAPA, 0)) / 1, 0) AS DA9_CAPA
     , ROUND(SUM(NVL(WB9_CAPA, 0)) / 1, 0) AS WB9_CAPA
     , ROUND(SUM(NVL(WEEK2_PLAN, 0)) / 1, 0) AS WEEK2_PLAN
     , ROUND(SUM(NVL(WEEK3_PLAN, 0)) / 1, 0) AS WEEK3_PLAN
     , ROUND(SUM(NVL(WEEK4_PLAN, 0)) / 1, 0) AS WEEK4_PLAN
     , ROUND(SUM(NVL(WEEK5_PLAN, 0)) / 1, 0) AS WEEK5_PLAN
     , ROUND(SUM(NVL(ORI_PLAN, 0)) / 1, 0) AS ORI_PLAN
     , ROUND(SUM(NVL(SHP_MONTH, 0)) / 1, 0) AS SHP_MONTH
     , ROUND(SUM(NVL(ORI_PLAN, 0) - NVL(SHP_MONTH, 0)) / 1, 0) AS MONTH_DEF
     , ROUND(SUM(NVL(REV_PLAN, 0)) / 1, 0) AS REV_PLAN
     , CASE WHEN SUM(NVL(ORI_PLAN, 0)) = 0 THEN 0
            ELSE ROUND(SUM(NVL(REV_PLAN, 0)) / SUM(NVL(ORI_PLAN, 0)) * 100, 0)
       END PER
     , ROUND(SUM(NVL(W_MOLD, 0)) / 1, 0) AS W_MOLD 
     , ROUND(SUM(NVL(W_WB, 0)) / 1, 0) AS W_WB
     , ROUND(SUM(NVL(W_DA, 0)) / 1, 0) AS W_DA
     , ROUND(SUM(NVL(W_BG, 0)) / 1, 0) AS W_BG
     , ROUND(SUM(NVL(W_ISSUE, 0)) / 1, 0) AS W_ISSUE
     , ROUND(SUM(NVL(TOTAL, 0)) / 1, 0) AS TOTAL
  FROM (
        SELECT MAT_GRP_1, MAT_GRP_2, MAT_GRP_3, MAT_GRP_4, MAT_GRP_5, MAT_GRP_6
             , MAT_GRP_7, MAT_GRP_8, MAT_GRP_9, MAT_GRP_10, MAT_CMF_7, MAT_CMF_10, MAT_ID, MAT_CMF_11
             , CASE WHEN MAT_GRP_9 = 'MEMORY' AND MAT_GRP_1 = 'HX' AND INSTR(MAT_ID, '_') = 0 THEN SUBSTR(MAT_ID, 1, 12) || '%' || SUBSTR(MAT_ID, -3)
                    WHEN MAT_GRP_9 = 'MEMORY' AND MAT_GRP_1 = 'HX' AND INSTR(MAT_ID, '_') > 0 THEN SUBSTR(MAT_ID, 1, INSTR(MAT_ID, '_')) || '%' || SUBSTR(MAT_ID, -3)
                    WHEN MAT_GRP_9 = 'MEMORY' AND MAT_GRP_1 = 'SE' THEN 'SEK_________-___' || SUBSTR(MAT_ID, -3)
                    ELSE MAT_ID
               END CONV_MAT_ID
             , VENDOR_ID AS SAP_CODE
          FROM MWIPMATDEF
         WHERE FACTORY = 'HMVA2'
           AND MAT_TYPE = 'FG' 
           AND DELETE_FLAG = ' ' 
           AND (MAT_GRP_5 IN ('1st','Merge', '-') OR MAT_GRP_5 LIKE 'Middle%') 
           AND MAT_GRP_3 <> 'COB' 
           AND MAT_ID LIKE '%'
       ) MAT 
     , ( 
        SELECT FACTORY, MAT_ID 
             , SUM(CASE WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D0_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D0_QTY + D1_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D0_QTY + D1_QTY + D2_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D0_QTY + D1_QTY + D2_QTY + D3_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY + D5_QTY
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D0_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D0_QTY + D1_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D0_QTY + D1_QTY + D2_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D0_QTY + D1_QTY + D2_QTY + D3_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY + D5_QTY 
                        ELSE 0
                   END) AS WEEK1_TTL 
             , SUM(W1_QTY) AS WEEK1_PLAN 
             , SUM(W2_QTY) AS WEEK2_PLAN 
             , SUM(W3_QTY) AS WEEK3_PLAN 
             , SUM(W4_QTY) AS WEEK4_PLAN 
             , SUM(W5_QTY) AS WEEK5_PLAN 
             , SUM(NVL(W1_QTY,0) + NVL(W2_QTY,0)) AS WEEK_TTL 
             , SUM(CASE WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D0_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D1_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D2_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D3_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D4_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D5_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D6_QTY
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D0_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D1_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D2_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D3_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D4_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D5_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D6_QTY 
                        ELSE 0
                   END) AS D0_PLAN 
             , SUM(CASE WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D1_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D2_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D3_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D4_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D5_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D6_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D7_QTY
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D1_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D2_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D3_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D4_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D5_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D6_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D7_QTY 
                        ELSE 0
                   END) AS D1_PLAN 
             , SUM(CASE WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D2_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D3_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D4_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D5_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D6_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D7_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D8_QTY
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D2_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D3_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D4_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D5_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D6_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D7_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D8_QTY 
                        ELSE 0
                   END) AS D2_PLAN 
             , SUM(CASE WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D3_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D4_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D5_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D6_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D7_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D8_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D9_QTY
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D3_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D4_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D5_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D6_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D7_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D8_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D9_QTY 
                        ELSE 0
                   END) AS D3_PLAN 
             , SUM(CASE WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D4_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D5_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D6_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D7_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D8_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D9_QTY
                        WHEN CALENDAR_ID = 'OTD' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D10_QTY
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 2 THEN D4_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 3 THEN D5_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 4 THEN D6_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 5 THEN D7_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 6 THEN D8_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 7 THEN D9_QTY 
                        WHEN CALENDAR_ID = 'SE' AND TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'D') = 1 THEN D10_QTY 
                        ELSE 0
                   END) AS D4_PLAN 
          FROM ( 
                SELECT FACTORY, MAT_ID, 'OTD' AS CALENDAR_ID 
                     , SUM(DECODE(PLAN_WEEK, '202020', D0_QTY, 0)) AS D0_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D1_QTY, 0)) AS D1_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D2_QTY, 0)) AS D2_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D3_QTY, 0)) AS D3_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D4_QTY, 0)) AS D4_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D5_QTY, 0)) AS D5_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D6_QTY, 0)) AS D6_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D0_QTY, 0)) AS D7_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D1_QTY, 0)) AS D8_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D2_QTY, 0)) AS D9_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D3_QTY, 0)) AS D10_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D4_QTY, 0)) AS D11_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D5_QTY, 0)) AS D12_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D6_QTY, 0)) AS D13_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', WW_QTY, 0)) AS W1_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', WW_QTY, 0)) AS W2_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202022', WW_QTY, 0)) AS W3_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202023', WW_QTY, 0)) AS W4_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202024', WW_QTY, 0)) AS W5_QTY 
                  FROM RWIPPLNWEK 
                 WHERE 1=1 
                   AND FACTORY = 'HMVA2' 
                   AND GUBUN = '3' 
                   AND MAT_ID NOT LIKE 'SES%' 
                   AND PLAN_WEEK IN ('202020','202021','202022','202023','202024')
                 GROUP BY FACTORY, MAT_ID 
                 UNION ALL 
                SELECT FACTORY, MAT_ID, 'SE' AS CALENDAR_ID 
                     , SUM(DECODE(PLAN_WEEK, '202020', D0_QTY, 0)) AS D0_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D1_QTY, 0)) AS D1_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D2_QTY, 0)) AS D2_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D3_QTY, 0)) AS D3_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D4_QTY, 0)) AS D4_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D5_QTY, 0)) AS D5_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', D6_QTY, 0)) AS D6_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D0_QTY, 0)) AS D7_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D1_QTY, 0)) AS D8_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D2_QTY, 0)) AS D9_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D3_QTY, 0)) AS D10_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D4_QTY, 0)) AS D11_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D5_QTY, 0)) AS D12_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', D6_QTY, 0)) AS D13_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202020', WW_QTY, 0)) AS W1_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202021', WW_QTY, 0)) AS W2_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202022', WW_QTY, 0)) AS W3_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202023', WW_QTY, 0)) AS W4_QTY 
                     , SUM(DECODE(PLAN_WEEK, '202024', WW_QTY, 0)) AS W5_QTY 
                  FROM RWIPPLNWEK 
                 WHERE 1=1 
                   AND FACTORY = 'HMVA2' 
                   AND GUBUN = '3' 
                   AND MAT_ID LIKE 'SES%' 
                   AND PLAN_WEEK IN ('202020','202021','202022','202023','202024')
                 GROUP BY FACTORY, MAT_ID 
               ) 
         GROUP BY FACTORY, MAT_ID 
       ) PLN 
     , ( 
        SELECT MAT_ID 
             , SUM(CASE WHEN SHP_QTY_1 > 0 AND WORK_DATE = '20200511' THEN NVL(SHP_QTY_1, 0) ELSE 0 END) AS SHP_TODAY 
             , SUM(CASE WHEN SHP_QTY_1 > 0 AND MAT_ID LIKE 'SES%' AND WORK_DATE BETWEEN '20200511' AND '20200511' THEN NVL(SHP_QTY_1, 0)  
                        WHEN SHP_QTY_1 > 0 AND MAT_ID NOT LIKE 'SES%' AND WORK_DATE BETWEEN '20200509' AND '20200511' THEN NVL(SHP_QTY_1, 0) 
                        ELSE 0 END) AS SHP_WEEK  
             , SUM(CASE WHEN SHP_QTY_1 > 0 AND MAT_ID LIKE 'SES%' AND WORK_DATE BETWEEN '20200511' AND '20200510' THEN NVL(SHP_QTY_1, 0) 
                        WHEN SHP_QTY_1 > 0 AND MAT_ID NOT LIKE 'SES%' AND WORK_DATE BETWEEN '20200509' AND '20200510' THEN NVL(SHP_QTY_1, 0) 
                        ELSE 0 END) AS SHP_WEEK_TTL  
             , SUM(CASE WHEN WORK_DATE BETWEEN '20200501' AND '20200511' THEN NVL(SHP_QTY_1, 0) END) AS SHP_MONTH  
          FROM VSUMWIPOUT
         WHERE 1=1 
           AND FACTORY  = 'HMVA2' 
           AND CM_KEY_2 = 'PROD' 
           AND CM_KEY_3 LIKE 'P%' 
           AND LOT_TYPE = 'W' 
           AND MAT_ID NOT LIKE 'HX%' 
           AND WORK_DATE BETWEEN LEAST('20200501', '20200509', '20200511') AND '20200511' 
         GROUP BY MAT_ID 
         UNION ALL 
        SELECT MAT_ID 
             , SUM(CASE WHEN SHP_QTY_1 > 0 AND WORK_DATE = '20200511' THEN NVL(SHP_QTY_1, 0) ELSE 0 END) AS SHP_TODAY 
             , SUM(CASE WHEN SHP_QTY_1 > 0 AND WORK_DATE BETWEEN '20200509' AND '20200511' THEN NVL(SHP_QTY_1, 0) ELSE 0 END) AS SHP_WEEK 
             , SUM(CASE WHEN SHP_QTY_1 > 0 AND WORK_DATE BETWEEN '20200509' AND '20200510' THEN NVL(SHP_QTY_1, 0) ELSE 0 END) AS SHP_WEEK_TTL 
             , SUM(CASE WHEN WORK_DATE BETWEEN '20200501' AND '20200511' THEN NVL(SHP_QTY_1, 0) END) AS SHP_MONTH 
          FROM VSUMWIPOUT_06
         WHERE 1=1 
           AND FACTORY  = 'HMVA2' 
           AND CM_KEY_2 = 'PROD' 
           AND CM_KEY_3 LIKE 'P%' 
           AND LOT_TYPE = 'W' 
           AND MAT_ID LIKE 'HX%' 
           AND WORK_DATE BETWEEN '20200501' AND '20200511' 
         GROUP BY MAT_ID 
       ) SHP 
     , ( 
        SELECT MAT_ID
             , SUM(QTY) TOTAL
             , SUM(DECODE(OPER_GRP_1, 'HMK2A', QTY, 0)) AS HMK2A
             , SUM(DECODE(OPER_GRP_1, 'B/G', QTY, 0)) AS BG
             , SUM(DECODE(OPER_GRP_1, 'SAW', QTY, 0)) AS SAW
             , SUM(DECODE(OPER_GRP_1, 'S/P', QTY, 0)) AS SP
             , SUM(CASE WHEN OPER IN ('A0250','A0310','A0333','A0340','A0401','A0501', 'A0400', 'A0500', 'A0530', 'A0531', 'A0370', 'A0380', 'A0395') THEN QTY 
                        WHEN OPER_GRP_1 = 'SMT' THEN QTY 
                        ELSE 0 END) AS DA1 
             , SUM(CASE WHEN OPER IN ('A0402','A0502', 'A0532') THEN QTY ELSE 0 END) AS DA2 
             , SUM(CASE WHEN OPER IN ('A0403','A0503', 'A0533') THEN QTY ELSE 0 END) AS DA3 
             , SUM(CASE WHEN OPER IN ('A0404','A0504', 'A0534') THEN QTY ELSE 0 END) AS DA4 
             , SUM(CASE WHEN OPER IN ('A0405','A0505', 'A0535') THEN QTY ELSE 0 END) AS DA5 
             , SUM(CASE WHEN OPER IN ('A0406','A0506', 'A0536') THEN QTY ELSE 0 END) AS DA6 
             , SUM(CASE WHEN OPER IN ('A0407','A0507', 'A0537') THEN QTY ELSE 0 END) AS DA7 
             , SUM(CASE WHEN OPER IN ('A0408','A0508', 'A0538') THEN QTY ELSE 0 END) AS DA8 
             , SUM(CASE WHEN OPER IN ('A0409','A0509', 'A0539') THEN QTY ELSE 0 END) AS DA9 
             , SUM(CASE WHEN OPER IN ('A0551', 'A0601', 'A0550', 'A0600') THEN QTY
                        WHEN OPER = 'A0801' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0801' AND MAT_GRP_1 <> 'SE' THEN QTY 
                        ELSE 0 END) AS WB1 
             , SUM(CASE WHEN OPER IN ('A0552', 'A0602') THEN QTY
                        WHEN OPER = 'A0802' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0802' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, QTY) 
                        ELSE 0 END) AS WB2 
             , SUM(CASE WHEN OPER IN ('A0553', 'A0603') THEN QTY
                        WHEN OPER = 'A0803' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY  
                        WHEN OPER = 'A0803' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, QTY) 
                        ELSE 0 END) AS WB3 
             , SUM(CASE WHEN OPER IN ('A0554', 'A0604') THEN QTY
                        WHEN OPER = 'A0804' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0804' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, '4', 0, QTY) 
                        ELSE 0 END) AS WB4 
             , SUM(CASE WHEN OPER IN ('A0555', 'A0605') THEN QTY
                        WHEN OPER = 'A0805' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0805' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, '4', 0, '5', 0, QTY) 
                        ELSE 0 END) AS WB5 
             , SUM(CASE WHEN OPER IN ('A0556', 'A0606') THEN QTY
                        WHEN OPER = 'A0806' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0806' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, '4', 0, '5', 0, '6', 0, QTY) 
                        ELSE 0 END) AS WB6 
             , SUM(CASE WHEN OPER IN ('A0557', 'A0607') THEN QTY
                        WHEN OPER = 'A0807' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0807' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, '4', 0, '5', 0, '6', 0, '7', 0, QTY) 
                        ELSE 0 END) AS WB7 
             , SUM(CASE WHEN OPER IN ('A0558', 'A0608') THEN QTY
                        WHEN OPER = 'A0808' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0808' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, '4', 0, '5', 0, '6', 0, '7', 0, '8', 0, QTY) 
                        ELSE 0 END) AS WB8 
             , SUM(CASE WHEN OPER IN ('A0559', 'A0609') THEN QTY
                        WHEN OPER = 'A0809' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 <> 'Merge' THEN QTY 
                        WHEN OPER = 'A0809' AND MAT_GRP_1 <> 'SE' THEN DECODE(SUBSTR(MAT_GRP_4,-1), '2', 0, '3', 0, '4', 0, '5', 0, '6', 0, '7', 0, '8', 0, '9', 0, QTY) 
                        ELSE 0 END) AS WB9 
             , SUM(CASE WHEN OPER_GRP_1 = 'GATE' AND MAT_GRP_5 = '-' THEN QTY 
                        WHEN OPER_GRP_1 = 'GATE' AND MAT_GRP_1 = 'SE' AND MAT_GRP_5 = 'Merge' THEN QTY 
                        WHEN OPER_GRP_1 = 'GATE' AND MAT_GRP_1 <> 'SE' AND SUBSTR(MAT_GRP_4,-1) = SUBSTR(OPER, -1) THEN QTY 
                        ELSE 0 END) AS GATE 
             , SUM(CASE WHEN OPER IN ('A0950','A0900', 'A0910', 'A0920', 'A0930') THEN QTY ELSE 0 END) AS PLASMA 
             , SUM(CASE WHEN OPER IN ('A1000','A0980') THEN QTY ELSE 0 END) AS MOLD 
             , SUM(DECODE(OPER_GRP_1, 'CURE', QTY, 0)) AS CURE
             , SUM(DECODE(OPER_GRP_1, 'M/K', QTY, 0)) AS MK
             , SUM(DECODE(OPER_GRP_1, 'TRIM', QTY, 0)) AS TRIM
             , SUM(DECODE(OPER_GRP_1, 'TIN', QTY, 0)) AS TIN
             , SUM(DECODE(OPER_GRP_1, 'S/B/A', QTY, 0)) AS SBA
             , SUM(DECODE(OPER_GRP_1, 'SIG', QTY, 0)) AS SIG
             , SUM(DECODE(OPER, 'A1790', QTY, 0)) AS DC1
             , SUM(DECODE(OPER, 'A1795', QTY, 0)) AS DC2
             , SUM(CASE WHEN OPER_GRP_1 = 'AVI' AND OPER NOT IN ('A1790', 'A1795') THEN QTY ELSE 0 END) AS AVI
             , SUM(CASE WHEN OPER = 'A2030' THEN QTY ELSE 0 END) AS BAKE
             , SUM(CASE WHEN OPER IN ('A2050') THEN QTY ELSE 0 END) AS PVI
             , SUM(CASE WHEN OPER IN ('A2100','A2300') THEN QTY ELSE 0 END) AS QC_GATE 
             , SUM(DECODE(OPER_GRP_1, 'HMK3A', QTY, 0)) AS HMK3A
             , SUM(DECODE(OPER_GRP_1, 'HMK2A', 0, QTY)) AS W_ISSUE
             , SUM(CASE WHEN OPER_GRP_1 IN ('HMK2A', 'B/G') THEN 0 ELSE QTY END) AS W_BG
             , SUM(CASE WHEN OPER_GRP_1 IN ('HMK2A', 'B/G', 'SAW', 'SMT', 'S/P', 'D/A') THEN 0 
                        WHEN OPER_GRP_1 = 'W/B' AND MAT_GRP_4 NOT IN ('-','FD','FU') AND MAT_GRP_5 <> 'Merge' THEN 0 
                        ELSE QTY END) AS W_DA 
             , SUM(CASE WHEN OPER_GRP_1 IN ('HMK2A', 'B/G', 'SAW', 'SMT', 'S/P', 'D/A', 'W/B') THEN 0 ELSE QTY END) AS W_WB
             , SUM(CASE WHEN OPER_GRP_1 IN ('HMK2A', 'B/G', 'SAW', 'SMT', 'S/P', 'D/A', 'W/B', 'GATE', 'MOLD') THEN 0 ELSE QTY END) AS W_MOLD
          FROM (
                SELECT A.MAT_ID, A.OPER, B.OPER_GRP_1, C.MAT_GRP_1, C.MAT_GRP_4, C.MAT_GRP_5, QTY_1
                     , COMP_CNT, HX_COMP_MIN, HX_COMP_MAX 
                     , CASE WHEN MAT_GRP_1 = 'HX' AND HX_COMP_MIN IS NOT NULL
                                 THEN (CASE WHEN HX_COMP_MIN <> HX_COMP_MAX AND A.OPER > HX_COMP_MIN AND A.OPER <= HX_COMP_MAX THEN QTY_1 / NVL(COMP_CNT / 2,1)
                                            WHEN A.OPER <= HX_COMP_MAX THEN QTY_1 / NVL(COMP_CNT,1)
                                            ELSE QTY_1 END)
                            WHEN A.OPER <= 'A0395' THEN QTY_1 / NVL(COMP_CNT,1) 
                            ELSE QTY_1 
                       END QTY 
                  FROM RWIPLOTSTS A 
                     , MWIPOPRDEF B
                     , VWIPMATDEF C
                 WHERE 1=1 
                   AND A.FACTORY = B.FACTORY 
                   AND A.FACTORY = C.FACTORY 
                   AND A.OPER = B.OPER
                   AND A.MAT_ID = C.MAT_ID
                   AND A.FACTORY  = 'HMVA2' 
                   AND A.LOT_DEL_FLAG = ' '
                   AND A.LOT_TYPE = 'W'
                   AND A.LOT_CMF_5 LIKE 'P%' 
                   AND C.DELETE_FLAG = ' ' 
               )
         GROUP BY MAT_ID
       ) WIP  
     , ( 
        SELECT MAT.MAT_ID
             , SUM(CASE WHEN GUBUN ='DA' AND MAT.MAT_GRP_5 IN ('Merge', '-') THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA_CAPA
             , SUM(CASE WHEN GUBUN ='WB' AND MAT.MAT_GRP_5 IN ('Merge', '-') THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB_CAPA
             , SUM(CASE WHEN RES.OPER IN ('A0333','A0400', 'A0401') THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA1_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0402' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA2_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0403' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA3_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0404' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA4_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0405' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA5_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0406' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA6_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0407' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA7_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0408' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA8_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0409' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.68 * RES.RAS_CNT, 0)) ELSE 0 END) AS DA9_CAPA
             , SUM(CASE WHEN RES.OPER IN ('A0600', 'A0601') THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB1_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0602' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB2_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0603' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB3_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0604' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB4_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0605' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB5_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0606' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB6_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0607' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB7_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0608' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB8_CAPA
             , SUM(CASE WHEN RES.OPER = 'A0609' THEN TRUNC(NVL(NVL(UPH.UPEH,0) * 24 * 0.71 * RES.RAS_CNT, 0)) ELSE 0 END) AS WB9_CAPA
          FROM ( 
                SELECT FACTORY, RES_STS_2, RES_STS_8 AS OPER 
                     , CASE WHEN RES_STS_8 LIKE 'A06%' THEN 'WB' ELSE 'DA' END AS GUBUN 
                     , RES_GRP_6 AS RES_MODEL, RES_GRP_7 AS UPEH_GRP, COUNT(RES_ID) AS RAS_CNT 
                  FROM MRASRESDEF 
                 WHERE FACTORY  = 'HMVA2' 
                   AND RES_CMF_9 = 'Y' 
                   AND RES_CMF_7 = 'Y' 
                   AND DELETE_FLAG = ' ' 
                   AND (RES_STS_8 LIKE 'A04%' OR RES_STS_8 LIKE 'A06%' OR RES_STS_8 = 'A0333')
                   AND (RES_STS_1 NOT IN ('C200', 'B199') OR RES_UP_DOWN_FLAG = 'U') 
                 GROUP BY FACTORY,RES_STS_2,RES_STS_8,RES_GRP_6,RES_GRP_7 
               ) RES 
             , CRASUPHDEF UPH 
             , MWIPMATDEF MAT 
         WHERE 1 = 1 
           AND RES.FACTORY = UPH.FACTORY(+) 
           AND RES.FACTORY = MAT.FACTORY 
           AND RES.OPER = UPH.OPER(+) 
           AND RES.RES_MODEL = UPH.RES_MODEL(+) 
           AND RES.UPEH_GRP = UPH.UPEH_GRP(+) 
           AND RES.RES_STS_2 = UPH.MAT_ID(+) 
           AND RES.RES_STS_2 = MAT.MAT_ID 
           AND MAT.DELETE_FLAG = ' ' 
         GROUP BY MAT.MAT_ID 
       ) CAP  
     , ( 
        SELECT MAT_ID 
             , DECODE(RESV_FIELD1, ' ', 0, RESV_FIELD1) AS ORI_PLAN 
             , DECODE(RESV_FIELD3, ' ', 0, RESV_FIELD3) AS REV_PLAN 
          FROM CWIPPLNMON 
         WHERE FACTORY  = 'HMVA2' 
           AND PLAN_MONTH = '202005' 
           AND PLAN_QTY_ASSY + DECODE(RESV_FIELD3, ' ', 0, RESV_FIELD3) > 0 
       ) MON  
 WHERE 1 = 1  
   AND MAT.MAT_ID = PLN.MAT_ID(+) 
   AND MAT.MAT_ID = SHP.MAT_ID(+) 
   AND MAT.MAT_ID = WIP.MAT_ID(+) 
   AND MAT.MAT_ID = CAP.MAT_ID(+) 
   AND MAT.MAT_ID = MON.MAT_ID(+) 
 GROUP BY MAT.MAT_GRP_1,  ' ', MAT.MAT_GRP_2, MAT.MAT_GRP_3, MAT.MAT_GRP_4,  ' ', MAT.MAT_GRP_6,  ' ',  ' ',  ' ', MAT.CONV_MAT_ID,  ' ',  ' ',  ' ' 
HAVING SUM(NVL(WEEK1_PLAN, 0) + NVL(SHP_WEEK, 0) + NVL(TOTAL, 0) + NVL(DA_CAPA, 0) + NVL(WB_CAPA, 0) + NVL(ORI_PLAN, 0) + NVL(REV_PLAN, 0) + NVL(SHP_MONTH, 0)) > 0
 ORDER BY MAT.MAT_GRP_1,  ' ', MAT.MAT_GRP_2, MAT.MAT_GRP_3, MAT.MAT_GRP_4,  ' ', MAT.MAT_GRP_6,  ' ',  ' ',  ' ', MAT.CONV_MAT_ID,  ' ',  ' ',  ' '
 )

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,1440)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,1440))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,1440),'', 1440, NVL(MOV.RUN_TIME,1440)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,1440)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200421220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200422' AND '20200422' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200422' AND '20200422'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 1440 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200422' AND '20200422'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200421220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN (NVL(SUM(RUN_TIME), 1440) - (NVL(SUM(TIME_SUM), 0) / 60)) = 0 THEN 0 
            ELSE ROUND(((NVL(SUM(RUN_TIME), 1440) / DECODE(SUM(TOTAL_RUN_TIME), 0, 1440, SUM(TOTAL_RUN_TIME))) * 100) * (NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0)) / 100, 2) 
       END AS TOTAL_PERCENT 
     , CASE WHEN NVL(SUM(VALUE_RUN_TIME), 0) = 0 THEN 0 
            WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0 
            ELSE NVL(ROUND((SUM(VALUE_RUN_TIME) / DECODE(SUM(RUN_TIME), 0, 1440, SUM(RUN_TIME))) * 100, 2), 0) 
       END AS ABILITY_PERCENT 
     , ROUND((NVL(SUM(RUN_TIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS TIME_PERCENT 
     , ROUND((NVL(SUM(REALTIME), 1440) / NVL(SUM(TOTAL_RUN_TIME), 1440)) * 100, 2) AS AUTO_TIME_PERCENT 
     , ROUND((NVL(SUM(TOTAL_RUN_TIME), 1440) - SUM(DOWN_TIME_RUNDOWN)) / NVL(SUM(TOTAL_RUN_TIME), 1440) * 100, 2) AS LOSS_PERCENT 
     , SUM(TOTAL_RUN_TIME) AS TOTAL_RUN_TIME 
     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
     , SUM(RUN_TIME) AS RUN_TIME
     , ROUND(SUM(REALTIME), 2) AS AUTO_REALTIME
     , SUM(DOWN_TIME) AS DOWN_TIME
     , SUM(QTY) AS QTY
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN NVL(SUM(RUN_TIME),0) = 0 THEN 0  
                  WHEN SUM(DOWN_CNT_BM) = 0 THEN SUM(TOTAL_RUN_TIME) 
                  WHEN SUM(DOWN_CNT_BM) = 1 THEN (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / 2 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_BM) 
             END, 0) AS MTBF 
     , SUM(MTTC) AS MTTC
     , ROUND(SUM(RAITO_BM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_RUNDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_PM) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_DEVCHG) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ENGDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_SUPERDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_UTILDOWN) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , ROUND(SUM(RAITO_ETC) / SUM(RAITO_RUN_TIME)*100,2) AS RAITO_BM
     , SUM(DOWN_TIME_BM)
     , SUM(DOWN_TIME_RUNDOWN)
     , SUM(DOWN_TIME_PM)
     , SUM(DOWN_TIME_DEVCHG)
     , SUM(DOWN_TIME_ENGDOWN)
     , SUM(DOWN_TIME_SUPERDOWN)
     , SUM(DOWN_TIME_UTILDOWN)
     , SUM(DOWN_TIME_ETC)
     , SUM(DOWN_CNT_BM)
     , SUM(DOWN_CNT_RUNDOWN)
     , SUM(DOWN_CNT_PM)
     , SUM(DOWN_CNT_DEVCHG)
     , SUM(DOWN_CNT_ENGDOWN)
     , SUM(DOWN_CNT_SUPERDOWN)
     , SUM(DOWN_CNT_UTILDOWN)
     , SUM(DOWN_CNT_ETC)
     , ROUND(CASE WHEN SUM(TOTAL_RUN_TIME) = SUM(DOWN_TIME) THEN 0 
                  WHEN SUM(DOWN_CNT_H) = 0 THEN SUM(RUN_TIME) 
                  ELSE (SUM(TOTAL_RUN_TIME) - SUM(DOWN_TIME)) / SUM(DOWN_CNT_H) 
             END, 0) AS MTBF_TEST 
  FROM (
        SELECT NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_1), '-') AS TEAM 
             , NVL((SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY = RES.FACTORY AND TABLE_NAME = 'H_DEPARTMENT' AND ROWNUM=1 AND KEY_1 = RES.RES_GRP_2), '-') AS PART
             , RES.RES_GRP_3 AS EQP_TYPE, RES.RES_GRP_5 AS MAKER, RES.RES_GRP_6 AS MODEL, RES.RES_ID AS RES_ID, RES.SUB_AREA_ID
             , RES_CMF_1 AS SERIAL, RES_CMF_4 AS ASSET_TYPE, RES_CMF_19 AS OLD_NEW
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN (SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0)) / 60)) = 0 THEN 0
                    ELSE ROUND((ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2) * ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2))/100,2)
               END  AS TOTAL_PERCENT
             , CASE WHEN SUM(NVL(MOV.VALUE_RUN_TIME,0)) = 0 THEN 0
                    WHEN SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(NVL(DWH.TIME_SUM,0))/60) = 0 THEN 0
                    ELSE NVL(ROUND((SUM(MOV.VALUE_RUN_TIME) / (SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(DWH.TIME_SUM)/60),0)))*100,2),0)
               END  AS ABILITY_PERCENT
             , ROUND(((SUM(NVL(MOV.RUN_TIME,1440)) - NVL((SUM(TIME_SUM)/60),0)) / SUM(NVL(MOV.RUN_TIME,1440)))*100,2) AS TIME_PERCENT
             , DECODE(SUM(DWH.DOWN_TIME_RUNDOWN),0,100, ROUND((((SUM(NVL(MOV.RUN_TIME,1440)) - SUM(DWH.DOWN_TIME_RUNDOWN)))/SUM(NVL(MOV.RUN_TIME,1440))*100),2)) AS LOSS_PERCENT
             , DECODE(NVL(MOV.RUN_TIME,1440),'', 1440, NVL(MOV.RUN_TIME,1440)) AS TOTAL_RUN_TIME
             , NVL(SUM(MOV.VALUE_RUN_TIME),0) AS VALUE_RUN_TIME
             , CASE WHEN SUM(NVL(MOV.RUN_TIME,0)) = 0 THEN 0
                    ELSE ROUND(SUM(NVL(MOV.RUN_TIME,0)) - NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0),2)
               END AS RUN_TIME
             , NVL(ROUND((SUM(DWH.TIME_SUM)/60),2),0) AS DOWN_TIME
             , NVL(SUM(MOV.QTY),0) AS QTY
             , DECODE(SUM(NVL(DWH.DOWN_CNT_BM,0)),0,0,ROUND((SUM(NVL(MOV.RUN_TIME,1440)) - (SUM(DWH.TIME_SUM)/60))/(SUM(DWH.DOWN_CNT_BM)+SUM(DWH.DOWN_CNT_PM) + SUM(DWH.DOWN_CNT_ETC)),2)) AS MTBF
             , DECODE(SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)),0,0,ROUND((SUM(DWH.DOWN_TIME_DEVCHG)) / SUM(DWH.DOWN_CNT_DEVCHG),2)) AS MTTC
             , SUM(NVL(DWH.RAITO_BM,0)) AS RAITO_BM
             , SUM(NVL(MOV.RUN_TIME,1440)) AS RAITO_RUN_TIME
             , SUM(NVL(DWH.RAITO_RUNDOWN,0)) AS RAITO_RUNDOWN
             , SUM(NVL(DWH.RAITO_PM,0)) AS RAITO_PM
             , SUM(NVL(DWH.RAITO_DEVCHG,0)) AS RAITO_DEVCHG
             , SUM(NVL(DWH.RAITO_ENGDOWN,0)) AS RAITO_ENGDOWN
             , SUM(NVL(DWH.RAITO_SUPERDOWN,0)) AS RAITO_SUPERDOWN
             , SUM(NVL(DWH.RAITO_UTILDOWN,0)) AS RAITO_UTILDOWN
             , SUM(NVL(DWH.RAITO_ETC,0)) AS RAITO_ETC
             , SUM(NVL(DWH.DOWN_TIME_BM,0)) AS DOWN_TIME_BM
             , SUM(NVL(DWH.DOWN_TIME_RUNDOWN,0)) AS DOWN_TIME_RUNDOWN
             , SUM(NVL(DWH.DOWN_TIME_PM,0)) AS DOWN_TIME_PM
             , SUM(NVL(DWH.DOWN_TIME_DEVCHG,0)) AS DOWN_TIME_DEVCHG
             , SUM(NVL(DWH.DOWN_TIME_ENGDOWN,0)) AS DOWN_TIME_ENGDOWN
             , SUM(NVL(DWH.DOWN_TIME_SUPERDOWN,0)) AS DOWN_TIME_SUPERDOWN
             , SUM(NVL(DWH.DOWN_TIME_UTILDOWN,0)) AS DOWN_TIME_UTILDOWN
             , SUM(NVL(DWH.DOWN_TIME_ETC,0)) AS DOWN_TIME_ETC
             , SUM(NVL(TIME_SUM,0)) AS TIME_SUM 
             , SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_BM
             , SUM(NVL(DWH.DOWN_CNT_RUNDOWN,0)) AS DOWN_CNT_RUNDOWN
             , SUM(NVL(DWH.DOWN_CNT_PM,0)) AS DOWN_CNT_PM
             , SUM(NVL(DWH.DOWN_CNT_DEVCHG,0)) AS DOWN_CNT_DEVCHG
             , SUM(NVL(DWH.DOWN_CNT_ENGDOWN,0)) AS DOWN_CNT_ENGDOWN
             , SUM(NVL(DWH.DOWN_CNT_SUPERDOWN,0)) AS DOWN_CNT_SUPERDOWN
             , SUM(NVL(DWH.DOWN_CNT_UTILDOWN,0)) AS DOWN_CNT_UTILDOWN
             , SUM(NVL(DWH.DOWN_CNT_ETC,0)) AS DOWN_CNT_ETC
             , SUM(NVL(DWH.DOWN_CNT_H,0)) + SUM(NVL(DWH.DOWN_CNT_BM,0)) AS DOWN_CNT_H
             , SUM(NVL(RAL.RUN_TIME/60,0)) AS REALTIME
          FROM (
                SELECT FACTORY,RES_ID
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM',TIME_SUM/60, 0)) AS RAITO_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)) AS RAITO_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM',TIME_SUM/60, 0)) AS RAITO_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)) AS RAITO_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)) AS RAITO_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)) AS RAITO_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)) AS RAITO_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)) AS RAITO_ETC
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'BM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_BM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_RUNDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'PM', TIME_SUM/60, 0)), 2) AS DOWN_TIME_PM
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', TIME_SUM/60, 0)), 2) AS DOWN_TIME_DEVCHG
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ENGDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_SUPERDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', TIME_SUM/60, 0)), 2) AS DOWN_TIME_UTILDOWN
                     , ROUND(SUM(DECODE(DOWN_EVENT_ID, 'ETC', TIME_SUM/60, 0)), 2) AS DOWN_TIME_ETC
                     , SUM(TIME_SUM) AS TIME_SUM
                     , SUM(DECODE(DOWN_EVENT_ID, 'BM', DOWN_CNT, 0)) AS DOWN_CNT_BM
                     , SUM(DECODE(DOWN_EVENT_ID, 'RUNDOWN', DOWN_CNT, 0)) AS DOWN_CNT_RUNDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'PM', DOWN_CNT, 0)) AS DOWN_CNT_PM
                     , SUM(DECODE(DOWN_EVENT_ID, 'DEVCHG', DOWN_CNT, 0)) AS DOWN_CNT_DEVCHG
                     , SUM(DECODE(DOWN_EVENT_ID, 'ENGDOWN', DOWN_CNT, 0)) AS DOWN_CNT_ENGDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'SUPERDOWN', DOWN_CNT, 0)) AS DOWN_CNT_SUPERDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'UTILDOWN', DOWN_CNT, 0)) AS DOWN_CNT_UTILDOWN
                     , SUM(DECODE(DOWN_EVENT_ID, 'ETC', DOWN_CNT, 0)) AS DOWN_CNT_ETC
                     , SUM(DECODE(H_CODE, 'H', DOWN_CNT, 0)) AS DOWN_CNT_H
                  FROM (
                        SELECT MNT.FACTORY,MNT.RES_ID, MNT.MAINT_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,2) IN ('H1','H2','H3','H4') THEN 'H' END AS H_CODE
                             , CASE WHEN SUBSTR(MAINT_CODE,0,1)='A' THEN 'BM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='B' THEN 'RUNDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='C' THEN 'PM'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='D' THEN 'DEVCHG'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='E' THEN 'ENGDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='F' THEN 'SUPERDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='G' THEN 'UTILDOWN'
                                    WHEN SUBSTR(MAINT_CODE,0,1)='H' THEN 'ETC'
                               END AS DOWN_EVENT_ID,NVL(SUM(TIME_SUM),0) AS TIME_SUM
                             , DECODE(SUBSTR(MAINT_CODE,0,1) 
                                      , 'B', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'D', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'E', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0) 
                                      , 'F', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      , 'G', NVL(DECODE(MAINT_STEP,'D_WAIT',SUM(FREQUENCY)),0)
                                      ,  NVL(DECODE(MAINT_STEP,'D_MAINT',SUM(FREQUENCY)),0)
                               ) AS DOWN_CNT
                          FROM CSUMRESMNT@RPTTOMES MNT
                             , MRASRESDEF RES
                         WHERE 1=1
                           AND MNT.FACTORY = RES.FACTORY
                           AND MNT.RES_ID = RES.RES_ID
                           AND RES.RES_CMF_20 < '20200415220000'
                           AND MNT.FACTORY  = 'HMVA2' 
                           AND MNT.WORK_DATE BETWEEN '20200416' AND '20200416' 
                           AND MNT.MAINT_CODE NOT IN ('D126','D216','D316')
                         GROUP BY MNT.FACTORY, MNT.RES_ID, MNT.MAINT_CODE, MNT.MAINT_STEP
                       ) RES
                 GROUP BY FACTORY, RES_ID
                 ORDER BY RES_ID
               ) DWH
             , (
                SELECT RES_ID,SUM(RUN_TIME) AS RUN_TIME 
                  FROM CSUMRASTIM@RPTTOMES
                 WHERE 1 = 1
                   AND WORK_DATE BETWEEN '20200416' AND '20200416'
                 GROUP BY RES_ID 
               ) RAL
             , (
                SELECT MOV.FACTORY
                     , MOV.RES_ID
                     , SUM(LOSS_QTY) AS LOSS_QTY
                     , 1440 AS RUN_TIME
                     , SUM(VALUE_RUN_TIME) AS VALUE_RUN_TIME
                     , SUM(QTY + LOSS_QTY) AS QTY
                  FROM CSUMRASMOV@RPTTOMES MOV
                     , MWIPMATDEF MAT 
                 WHERE 1=1
                   AND MOV.FACTORY = MAT.FACTORY 
                   AND MOV.MAT_ID = MAT.MAT_ID 
                   AND MOV.FACTORY = 'HMVA2'
                   AND MOV.WORK_DAY BETWEEN '20200416' AND '20200416'
                   AND MOV.OPER LIKE '%'
                 GROUP BY MOV.FACTORY,MOV.RES_ID
               ) MOV
             , MRASRESDEF RES
         WHERE 1=1 
           AND RES.FACTORY = DWH.FACTORY(+)  
           AND RES.FACTORY = MOV.FACTORY(+)   
           AND RES.RES_ID = DWH.RES_ID(+)  
           AND RES.RES_ID = RAL.RES_ID(+)  
           AND RES.RES_ID = MOV.RES_ID(+)   
           AND RES.FACTORY  = 'HMVA2' 
           AND RES.RES_CMF_20 < '20200415220000'   
           AND RES.RES_TYPE IN ('EQUIPMENT', 'LINE')
           AND RES.RES_CMF_9='Y'
           AND RES.DELETE_FLAG = ' '
           AND RES.RES_ID NOT LIKE '%$$$%'
         GROUP BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, MOV.RUN_TIME, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
         ORDER BY RES.FACTORY,RES.RES_GRP_1, RES.RES_GRP_2, RES_GRP_3, RES.RES_GRP_5, RES.RES_GRP_6, RES.RES_ID, RES.SUB_AREA_ID, RES.RES_CMF_1, RES.RES_CMF_4, RES.RES_CMF_19
       )
 GROUP BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID
 ORDER BY TEAM,TEAM,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', RES_ID

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD010305'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT FACTORY Code, FAC_DESC Data
  FROM MWIPFACDEF
 WHERE FAC_GRP_5 = 'Y' 
 ORDER BY FAC_GRP_4 ASC
-------------------------------------------------------------
SELECT OPER, OPER_DESC  FROM MWIPOPRDEF
  WHERE FACTORY = 'HMVA2'  AND OPER NOT IN ('00001', '00002') AND OPER NOT LIKE 'V%' ORDER BY DECODE(OPER_CMF_2, ' ', 99999, TO_NUMBER(OPER_CMF_2)), OPER
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT A.OPER AS STEP, A.MAT_CMF_10 AS PIN_TYPE, A.MAT_ID AS PRODUCT,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' 
     , A.LOT_ID 
     , A.LOT_CMF_5 
     , A.STATUS 
     , A.HOLD_CODE 
     , A.HOLD_DESC 
     , A.CREATE_DAYDIFF 
     , A.ISSUE_DAYDIFF 
     , A.OPER_IN_DAYDIFF 
     , A.QTY_1 
     , A.LOT_CMF_14 
     , A.ISSUE_TIME 
     , A.OPER_IN_TIME 
     , A.LAST_COMMENT 
     , A.LOT_CMF_7 
     , CASE WHEN A.S_TIME IS NOT NULL AND A.S_TIME <= A.E_TIME THEN TRUNC(TO_DATE(A.E_TIME, 'YYYYMMDDHH24MISS') - TO_DATE(A.S_TIME, 'YYYYMMDDHH24MISS'), 2) END AS DA_DAYDIFF
  FROM ( 
        SELECT C.* 
             , A.OPER  
             , A.LOT_ID  
             , A.LOT_CMF_5  
             , CASE WHEN HOLD_FLAG = 'Y' THEN 'HOLD'
                    ELSE DECODE(A.LOT_STATUS, 'PROC', 'RUN', A.LOT_STATUS)   
               END AS STATUS 
             , A.HOLD_CODE 
             , DECODE(A.HOLD_CODE, ' ', ' ', (SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY=A.FACTORY AND TABLE_NAME = 'HOLD_CODE' AND KEY_1 = A.HOLD_CODE AND ROWNUM=1)) HOLD_DESC 
             , TRUNC(TO_DATE('20200511142256','YYYYMMDDHH24MISS') - DECODE(A.LOT_CMF_14, ' ', TO_DATE(A.LOT_CMF_14,'YYYYMMDDHH24MISS'), TO_DATE(A.LOT_CMF_14,'YYYYMMDDHH24MISS')), 2) AS CREATE_DAYDIFF 
             , TRUNC(TO_DATE('20200511142256','YYYYMMDDHH24MISS') - DECODE(A.RESV_FIELD_1, ' ', SYSDATE, TO_DATE(A.RESV_FIELD_1,'YYYYMMDDHH24MISS')), 2) AS ISSUE_DAYDIFF 
             , TRUNC(TO_DATE('20200511142256','YYYYMMDDHH24MISS') - TO_DATE(A.OPER_IN_TIME,'YYYYMMDDHH24MISS'), 2) AS OPER_IN_DAYDIFF 
             , A.QTY_1  
             , TO_CHAR(TO_DATE(A.LOT_CMF_14, 'YYYYMMDDHH24MISS'), 'YY/MM/DD HH24:MI:SS') AS LOT_CMF_14 
             , DECODE(A.RESV_FIELD_1, ' ', ' ', TO_CHAR(TO_DATE(A.RESV_FIELD_1, 'YYYYMMDDHH24MISS'), 'YY/MM/DD HH24:MI:SS')) AS ISSUE_TIME 
             , DECODE(A.OPER_IN_TIME, ' ', ' ', TO_CHAR(TO_DATE(A.OPER_IN_TIME, 'YYYYMMDDHH24MISS'), 'YY/MM/DD HH24:MI:SS')) AS OPER_IN_TIME 
             , A.LAST_COMMENT
             , A.LOT_CMF_7
             , (SELECT TRAN_TIME FROM RWIPLOTHIS WHERE FACTORY = 'HMVA2' AND HIST_DEL_FLAG = ' ' AND TRAN_CODE = 'END' AND OLD_OPER = 'A0250' AND LOT_ID = DECODE(D.FROM_TO_LOT_ID, NULL, A.LOT_ID, D.FROM_TO_LOT_ID)) AS S_TIME 
             , A.CREATE_TIME AS E_TIME 
          FROM RWIPLOTSTS A, MWIPMATDEF C 
             , (SELECT * FROM RWIPLOTSPL WHERE FACTORY = 'HMVA2' AND (OPER LIKE 'A04%' OR OPER = 'A0333') AND FROM_TO_FLAG = 'T') D
         WHERE 1=1
           AND A.FACTORY = C.FACTORY 
           AND A.MAT_ID = C.MAT_ID 
           AND A.LOT_ID = D.LOT_ID(+) 
           AND A.FACTORY  = 'HMVA2'  
           AND A.OPER NOT IN ('00001','00002') 
           AND A.MAT_VER = 1
           AND A.LOT_DEL_FLAG = ' ' 
           AND A.LOT_TYPE = 'W' 
           AND TRUNC(TO_DATE('20200511142256','YYYYMMDDHH24MISS') - TO_DATE(A.LOT_CMF_14,'YYYYMMDDHH24MISS'), 2) > 15
       ) A 
ORDER BY A.OPER, A.MAT_CMF_10, A.MAT_ID,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', A.LOT_ID, A.LOT_CMF_5, A.STATUS, A.HOLD_CODE, A.LOT_CMF_14, A.OPER_IN_TIME, A.LAST_COMMENT, A.LOT_CMF_7 

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT A.OPER AS STEP, A.MAT_CMF_10 AS PIN_TYPE, A.MAT_ID AS PRODUCT,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ' 
     , A.LOT_ID 
     , A.LOT_CMF_5 
     , A.STATUS 
     , A.HOLD_CODE 
     , A.HOLD_DESC 
     , A.CREATE_DAYDIFF 
     , A.ISSUE_DAYDIFF 
     , A.OPER_IN_DAYDIFF 
     , A.QTY_1 
     , A.LOT_CMF_14 
     , A.ISSUE_TIME 
     , A.OPER_IN_TIME 
     , A.LAST_COMMENT 
     , A.LOT_CMF_7 
     , CASE WHEN A.S_TIME IS NOT NULL AND A.S_TIME <= A.E_TIME THEN TRUNC(TO_DATE(A.E_TIME, 'YYYYMMDDHH24MISS') - TO_DATE(A.S_TIME, 'YYYYMMDDHH24MISS'), 2) END AS DA_DAYDIFF
  FROM ( 
        SELECT C.* 
             , A.OPER  
             , A.LOT_ID  
             , A.LOT_CMF_5  
             , CASE WHEN HOLD_FLAG = 'Y' THEN 'HOLD'
                    ELSE DECODE(A.LOT_STATUS, 'PROC', 'RUN', A.LOT_STATUS)   
               END AS STATUS 
             , A.HOLD_CODE 
             , DECODE(A.HOLD_CODE, ' ', ' ', (SELECT DATA_1 FROM MGCMTBLDAT WHERE FACTORY=A.FACTORY AND TABLE_NAME = 'HOLD_CODE' AND KEY_1 = A.HOLD_CODE AND ROWNUM=1)) HOLD_DESC 
             , TRUNC(TO_DATE('20200511142301','YYYYMMDDHH24MISS') - DECODE(A.LOT_CMF_14, ' ', TO_DATE(A.LOT_CMF_14,'YYYYMMDDHH24MISS'), TO_DATE(A.LOT_CMF_14,'YYYYMMDDHH24MISS')), 2) AS CREATE_DAYDIFF 
             , TRUNC(TO_DATE('20200511142301','YYYYMMDDHH24MISS') - DECODE(A.RESV_FIELD_1, ' ', SYSDATE, TO_DATE(A.RESV_FIELD_1,'YYYYMMDDHH24MISS')), 2) AS ISSUE_DAYDIFF 
             , TRUNC(TO_DATE('20200511142301','YYYYMMDDHH24MISS') - TO_DATE(A.OPER_IN_TIME,'YYYYMMDDHH24MISS'), 2) AS OPER_IN_DAYDIFF 
             , A.QTY_1  
             , TO_CHAR(TO_DATE(A.LOT_CMF_14, 'YYYYMMDDHH24MISS'), 'YY/MM/DD HH24:MI:SS') AS LOT_CMF_14 
             , DECODE(A.RESV_FIELD_1, ' ', ' ', TO_CHAR(TO_DATE(A.RESV_FIELD_1, 'YYYYMMDDHH24MISS'), 'YY/MM/DD HH24:MI:SS')) AS ISSUE_TIME 
             , DECODE(A.OPER_IN_TIME, ' ', ' ', TO_CHAR(TO_DATE(A.OPER_IN_TIME, 'YYYYMMDDHH24MISS'), 'YY/MM/DD HH24:MI:SS')) AS OPER_IN_TIME 
             , A.LAST_COMMENT
             , A.LOT_CMF_7
             , (SELECT TRAN_TIME FROM RWIPLOTHIS WHERE FACTORY = 'HMVA2' AND HIST_DEL_FLAG = ' ' AND TRAN_CODE = 'END' AND OLD_OPER = 'A0250' AND LOT_ID = DECODE(D.FROM_TO_LOT_ID, NULL, A.LOT_ID, D.FROM_TO_LOT_ID)) AS S_TIME 
             , A.CREATE_TIME AS E_TIME 
          FROM RWIPLOTSTS A, MWIPMATDEF C 
             , (SELECT * FROM RWIPLOTSPL WHERE FACTORY = 'HMVA2' AND (OPER LIKE 'A04%' OR OPER = 'A0333') AND FROM_TO_FLAG = 'T') D
         WHERE 1=1
           AND A.FACTORY = C.FACTORY 
           AND A.MAT_ID = C.MAT_ID 
           AND A.LOT_ID = D.LOT_ID(+) 
           AND A.FACTORY  = 'HMVA2'  
           AND A.OPER NOT IN ('00001','00002') 
           AND A.MAT_VER = 1
           AND A.LOT_DEL_FLAG = ' ' 
           AND A.LOT_TYPE = 'W' 
           AND TRUNC(TO_DATE('20200511142301','YYYYMMDDHH24MISS') - TO_DATE(A.LOT_CMF_14,'YYYYMMDDHH24MISS'), 2) > 5
       ) A 
ORDER BY A.OPER, A.MAT_CMF_10, A.MAT_ID,  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ',  ' ', A.LOT_ID, A.LOT_CMF_5, A.STATUS, A.HOLD_CODE, A.LOT_CMF_14, A.OPER_IN_TIME, A.LAST_COMMENT, A.LOT_CMF_7 

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
SELECT SYS_DATE     , SUBSTR(SYS_DATE, 5, 2)||'월 '||SUBSTR(SYS_DATE, 7, 2)||'일' AS CONV     , TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'DY') AS DY     , TO_CHAR(TO_DATE(SYS_DATE, 'YYYYMMDD'), 'DY') AS DY2  FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD'   AND (PLAN_YEAR, PLAN_WEEK) = (SELECT PLAN_YEAR, PLAN_WEEK FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD' AND SYS_DATE = '20200511')  ORDER BY SYS_DATE
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT MIN(SYS_DATE) AS START_DAY 
     , MAX(SYS_DATE) AS END_DAY 
     , PLAN_YEAR||DECODE(LENGTH(PLAN_WEEK), 1, '0'||PLAN_WEEK, PLAN_WEEK) AS WEEK
  FROM MWIPCALDEF 
 WHERE CALENDAR_ID = 'OTD'
   AND (PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) IN ( 
                                                SELECT WW
                                                  FROM (
                                                        SELECT WW
                                                             , ROW_NUMBER() OVER(ORDER BY WW) AS RNK
                                                          FROM (
                                                                SELECT DISTINCT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW
                                                                  FROM MWIPCALDEF
                                                                 WHERE CALENDAR_ID = 'OTD'
                                                                   AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') >= (
                                                                                                              SELECT MAX(PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) AS WW
                                                                                                                FROM MWIPCALDEF
                                                                                                               WHERE CALENDAR_ID = 'OTD'
                                                                                                                 AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') < (SELECT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD' AND SYS_DATE = '20200511')
                                                                                                                 AND SYS_DATE >= TO_CHAR(TO_DATE('20200511', 'YYYYMMDD')-14, 'YYYYMMDD')
                                                                                                             )
                                                               ) 
                                                       )
                                                 WHERE RNK <= 7
                                               ) 
 GROUP BY PLAN_YEAR, PLAN_WEEK 
 ORDER BY PLAN_YEAR, PLAN_WEEK

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT LANGUAGE_2 FROM RWEBFUNDEF WHERE FUNC_NAME = 'PRD011012'
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT SYS_DATE     , SUBSTR(SYS_DATE, 5, 2)||'월 '||SUBSTR(SYS_DATE, 7, 2)||'일' AS CONV     , TO_CHAR(TO_DATE('20200511', 'YYYYMMDD'), 'DY') AS DY     , TO_CHAR(TO_DATE(SYS_DATE, 'YYYYMMDD'), 'DY') AS DY2  FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD'   AND (PLAN_YEAR, PLAN_WEEK) = (SELECT PLAN_YEAR, PLAN_WEEK FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD' AND SYS_DATE = '20200511')  ORDER BY SYS_DATE
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
SELECT MIN(SYS_DATE) AS START_DAY 
     , MAX(SYS_DATE) AS END_DAY 
     , PLAN_YEAR||DECODE(LENGTH(PLAN_WEEK), 1, '0'||PLAN_WEEK, PLAN_WEEK) AS WEEK
  FROM MWIPCALDEF 
 WHERE CALENDAR_ID = 'OTD'
   AND (PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) IN ( 
                                                SELECT WW
                                                  FROM (
                                                        SELECT WW
                                                             , ROW_NUMBER() OVER(ORDER BY WW) AS RNK
                                                          FROM (
                                                                SELECT DISTINCT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW
                                                                  FROM MWIPCALDEF
                                                                 WHERE CALENDAR_ID = 'OTD'
                                                                   AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') >= (
                                                                                                              SELECT MAX(PLAN_YEAR || LPAD(PLAN_WEEK,2,'0')) AS WW
                                                                                                                FROM MWIPCALDEF
                                                                                                               WHERE CALENDAR_ID = 'OTD'
                                                                                                                 AND PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') < (SELECT PLAN_YEAR || LPAD(PLAN_WEEK,2,'0') AS WW FROM MWIPCALDEF WHERE CALENDAR_ID = 'OTD' AND SYS_DATE = '20200511')
                                                                                                                 AND SYS_DATE >= TO_CHAR(TO_DATE('20200511', 'YYYYMMDD')-14, 'YYYYMMDD')
                                                                                                             )
                                                               ) 
                                                       )
                                                 WHERE RNK <= 7
                                               ) 
 GROUP BY PLAN_YEAR, PLAN_WEEK 
 ORDER BY PLAN_YEAR, PLAN_WEEK

-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
WITH DT AS
(
 SELECT MAT_ID
      , SUM(DECODE(WORK_DATE, '20200509', SHP_QTY, 0)) AS D0_SHP
      , SUM(DECODE(WORK_DATE, '20200510', SHP_QTY, 0)) AS D1_SHP
      , SUM(DECODE(WORK_DATE, '20200511', SHP_QTY, 0)) AS D2_SHP
      , SUM(DECODE(WORK_DATE, '20200512', SHP_QTY, 0)) AS D3_SHP
      , SUM(DECODE(WORK_DATE, '20200513', SHP_QTY, 0)) AS D4_SHP
      , SUM(DECODE(WORK_DATE, '20200514', SHP_QTY, 0)) AS D5_SHP
      , SUM(DECODE(WORK_DATE, '20200515', SHP_QTY, 0)) AS D6_SHP
      , SUM(SHP_QTY) AS WW_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200509' THEN SHP_QTY ELSE 0 END) AS SUM_D0_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200510' THEN SHP_QTY ELSE 0 END) AS SUM_D1_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200511' THEN SHP_QTY ELSE 0 END) AS SUM_D2_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200512' THEN SHP_QTY ELSE 0 END) AS SUM_D3_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200513' THEN SHP_QTY ELSE 0 END) AS SUM_D4_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200514' THEN SHP_QTY ELSE 0 END) AS SUM_D5_SHP
      , SUM(CASE WHEN WORK_DATE <= '20200515' THEN SHP_QTY ELSE 0 END) AS SUM_D6_SHP
   FROM (
         SELECT WORK_DATE, MAT_ID
              , SUM(S1_FAC_OUT_QTY_1+S2_FAC_OUT_QTY_1+S3_FAC_OUT_QTY_1) AS SHP_QTY 
           FROM RSUMFACMOV
          WHERE 1=1
            AND WORK_DATE BETWEEN '20200509' AND '20200511'
            AND LOT_TYPE = 'W' 
            AND CM_KEY_1 = 'HMVA2'
            AND FACTORY NOT IN ('RETURN') 
            AND MAT_ID NOT LIKE 'HX%'
          GROUP BY WORK_DATE, MAT_ID
          UNION ALL
         SELECT WORK_DATE, MAT_ID
              , SUM(S1_FAC_OUT_QTY_1+S2_FAC_OUT_QTY_1+S3_FAC_OUT_QTY_1) AS SHP_QTY 
           FROM CSUMFACMOV
          WHERE 1=1
            AND WORK_DATE BETWEEN '20200509' AND '20200511'
            AND LOT_TYPE = 'W' 
            AND CM_KEY_1 = 'HMVA2'
            AND FACTORY NOT IN ('RETURN') 
            AND MAT_ID LIKE 'HX%'
          GROUP BY WORK_DATE, MAT_ID
        ) 
  GROUP BY MAT_ID
)
SELECT CUST_TYPE, (SELECT DATA_1 FROM MGCMTBLDAT WHERE TABLE_NAME = 'H_CUSTOMER' AND KEY_1 = MAT_GRP_1 AND ROWNUM=1) AS CUSTOMER, MAT_GRP_9,  ' ',  ' ',  ' ',  ' ', CONV_MAT_ID,  ' ', ' ' 
     , ROUND(SUM(D0_PLN) / 1000, 0) AS D0_PLN
     , ROUND(SUM(D1_PLN) / 1000, 0) AS D1_PLN
     , ROUND(SUM(D2_PLN) / 1000, 0) AS D2_PLN
     , ROUND(SUM(D3_PLN) / 1000, 0) AS D3_PLN
     , ROUND(SUM(D4_PLN) / 1000, 0) AS D4_PLN
     , ROUND(SUM(D5_PLN) / 1000, 0) AS D5_PLN
     , ROUND(SUM(D6_PLN) / 1000, 0) AS D6_PLN
     , ROUND(SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN + D6_PLN) / 1000, 0) AS WW_PLN_1
     , ROUND(SUM(WW_PLN_2) / 1000, 0) AS WW_PLN_2
     , ROUND(SUM(D0_SHP) / 1000, 0) AS D0_SHP
     , ROUND(SUM(D1_SHP) / 1000, 0) AS D1_SHP
     , ROUND(SUM(D2_SHP) / 1000, 0) AS D2_SHP
     , ROUND(SUM(D3_SHP) / 1000, 0) AS D3_SHP
     , ROUND(SUM(D4_SHP) / 1000, 0) AS D4_SHP
     , ROUND(SUM(D5_SHP) / 1000, 0) AS D5_SHP
     , ROUND(SUM(D6_SHP) / 1000, 0) AS D6_SHP
     , ROUND(SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP + D5_SHP + D6_SHP) / 1000, 0) AS WW_SHP_1
     , ROUND(SUM(WW_SHP_2) / 1000, 0) AS WW_SHP_2
     , ROUND(CASE WHEN SUM(D0_PLN) <= 0 AND SUM(D0_SHP) = 0 THEN 0
                  WHEN SUM(D0_PLN) <= 0 THEN 100
                  ELSE SUM(D0_SHP) / SUM(D0_PLN) * 100
             END, 0) AS D0_PER
     , ROUND(CASE WHEN SUM(D1_PLN) <= 0 AND SUM(D1_SHP) = 0 THEN 0
                  WHEN SUM(D1_PLN) <= 0 THEN 100
                  ELSE SUM(D1_SHP) / SUM(D1_PLN) * 100
             END, 0) AS D1_PER
     , ROUND(CASE WHEN SUM(D2_PLN) <= 0 AND SUM(D2_SHP) = 0 THEN 0
                  WHEN SUM(D2_PLN) <= 0 THEN 100
                  ELSE SUM(D2_SHP) / SUM(D2_PLN) * 100
             END, 0) AS D2_PER
     , ROUND(CASE WHEN SUM(D3_PLN) <= 0 AND SUM(D3_SHP) = 0 THEN 0
                  WHEN SUM(D3_PLN) <= 0 THEN 100
                  ELSE SUM(D3_SHP) / SUM(D3_PLN) * 100
             END, 0) AS D3_PER
     , ROUND(CASE WHEN SUM(D4_PLN) <= 0 AND SUM(D4_SHP) = 0 THEN 0
                  WHEN SUM(D4_PLN) <= 0 THEN 100
                  ELSE SUM(D4_SHP) / SUM(D4_PLN) * 100
             END, 0) AS D4_PER
     , ROUND(CASE WHEN SUM(D5_PLN) <= 0 AND SUM(D5_SHP) = 0 THEN 0
                  WHEN SUM(D5_PLN) <= 0 THEN 100
                  ELSE SUM(D5_SHP) / SUM(D5_PLN) * 100
             END, 0) AS D5_PER
     , ROUND(CASE WHEN SUM(D6_PLN) <= 0 AND SUM(D6_SHP) = 0 THEN 0
                  WHEN SUM(D6_PLN) <= 0 THEN 100
                  ELSE SUM(D6_SHP) / SUM(D6_PLN) * 100
             END, 0) AS D6_PER
     , ROUND(CASE WHEN SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN + D6_PLN) <= 0 AND SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP + D5_SHP + D6_SHP) = 0 THEN 0
                  WHEN SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN + D6_PLN) <= 0 THEN 100
                  ELSE SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP + D5_SHP + D6_SHP) / SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN + D6_PLN) * 100
             END, 0) AS WW_PER_1
     , ROUND(CASE WHEN SUM(WW_PLN_2) <= 0 AND SUM(WW_SHP_2) = 0 THEN 0
                  WHEN SUM(WW_PLN_2) <= 0 THEN 100
                  ELSE SUM(WW_SHP_2) / SUM(WW_PLN_2) * 100
             END, 0) AS WW_PER_2
     , ROUND((SUM(D0_SHP) - SUM(D0_PLN)) / 1000, 0) AS SUM_D0_DEF
     , ROUND((SUM(D0_SHP + D1_SHP) - SUM(D0_PLN + D1_PLN)) / 1000, 0) AS SUM_D1_DEF
     , ROUND((SUM(D0_SHP + D1_SHP + D2_SHP) - SUM(D0_PLN + D1_PLN + D2_PLN)) / 1000, 0) AS SUM_D2_DEF
     , ROUND((SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP) - SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN)) / 1000, 0) AS SUM_D3_DEF
     , ROUND((SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP) - SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN)) / 1000, 0) AS SUM_D4_DEF
     , ROUND((SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP + D5_SHP) - SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN)) / 1000, 0) AS SUM_D5_DEF
     , ROUND((SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP + D5_SHP + D6_SHP) - SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN + D6_PLN)) / 1000, 0) AS SUM_D6_DEF
     , ROUND((SUM(D0_SHP + D1_SHP + D2_SHP + D3_SHP + D4_SHP + D5_SHP + D6_SHP) - SUM(D0_PLN + D1_PLN + D2_PLN + D3_PLN + D4_PLN + D5_PLN + D6_PLN)) / 1000, 0) AS WW_DEF_1
     , ROUND((SUM(WW_SHP_2) - SUM(WW_PLN_2)) / 1000, 0) AS WW_DEF_2
  FROM (
        SELECT CUST_TYPE, MAT_GRP_1, MAT_GRP_2, MAT_GRP_4, MAT_GRP_6, MAT_GRP_9, MAT_GRP_10, MAT_CMF_11, CONV_MAT_ID
             , SUM(NVL(D0_PLN,0)) AS D0_PLN
             , CASE WHEN 20200509 > 20200511 THEN SUM(NVL(D1_PLN,0))
                    ELSE CASE WHEN SUM(NVL(SUM_D1_PLN,0) - NVL(SUM_D0_SHP,0)) <= 0 THEN 0
                              ELSE SUM(NVL(SUM_D1_PLN,0) - NVL(SUM_D0_SHP,0)) 
                          END
                END AS D1_PLN
             , CASE WHEN 20200510 > 20200511 THEN SUM(NVL(D2_PLN,0))
                    ELSE CASE WHEN SUM(NVL(SUM_D2_PLN,0) - NVL(SUM_D1_SHP,0)) <= 0 THEN 0
                              ELSE SUM(NVL(SUM_D2_PLN,0) - NVL(SUM_D1_SHP,0)) 
                          END
                END AS D2_PLN
             , CASE WHEN 20200511 > 20200511 THEN SUM(NVL(D3_PLN,0))
                    ELSE CASE WHEN SUM(NVL(SUM_D3_PLN,0) - NVL(SUM_D2_SHP,0)) <= 0 THEN 0
                              ELSE SUM(NVL(SUM_D3_PLN,0) - NVL(SUM_D2_SHP,0)) 
                          END
                END AS D3_PLN
             , CASE WHEN 20200512 > 20200511 THEN SUM(NVL(D4_PLN,0))
                    ELSE CASE WHEN SUM(NVL(SUM_D4_PLN,0) - NVL(SUM_D3_SHP,0)) <= 0 THEN 0
                              ELSE SUM(NVL(SUM_D4_PLN,0) - NVL(SUM_D3_SHP,0)) 
                          END
                END AS D4_PLN
             , CASE WHEN 20200513 > 20200511 THEN SUM(NVL(D5_PLN,0))
                    ELSE CASE WHEN SUM(NVL(SUM_D5_PLN,0) - NVL(SUM_D4_SHP,0)) <= 0 THEN 0
                              ELSE SUM(NVL(SUM_D5_PLN,0) - NVL(SUM_D4_SHP,0)) 
                          END
                END AS D5_PLN
             , CASE WHEN 20200514 > 20200511 THEN SUM(NVL(D6_PLN,0))
                    ELSE CASE WHEN SUM(NVL(SUM_D6_PLN,0) - NVL(SUM_D5_SHP,0)) <= 0 THEN 0
                              ELSE SUM(NVL(SUM_D6_PLN,0) - NVL(SUM_D5_SHP,0)) 
                          END
                END AS D6_PLN
             , SUM(WW_PLN) AS WW_PLN_2
             , CASE WHEN SUM(NVL(D0_PLN,0)) <= SUM(NVL(D0_SHP,0)) THEN SUM(NVL(D0_PLN,0)) ELSE SUM(NVL(D0_SHP,0)) END AS D0_SHP
             , CASE WHEN SUM(NVL(SUM_D1_PLN,0)) - SUM(NVL(SUM_D0_SHP,0)) <= 0 THEN 0 
                    WHEN SUM(NVL(SUM_D1_PLN,0)) - SUM(NVL(SUM_D0_SHP,0)) <= SUM(NVL(D1_SHP,0)) THEN SUM(NVL(SUM_D1_PLN,0)) - SUM(NVL(SUM_D0_SHP,0)) 
                    ELSE SUM(NVL(D1_SHP,0)) END AS D1_SHP 
             , CASE WHEN SUM(NVL(SUM_D2_PLN,0)) - SUM(NVL(SUM_D1_SHP,0)) <= 0 THEN 0 
                    WHEN SUM(NVL(SUM_D2_PLN,0)) - SUM(NVL(SUM_D1_SHP,0)) <= SUM(NVL(D2_SHP,0)) THEN SUM(NVL(SUM_D2_PLN,0)) - SUM(NVL(SUM_D1_SHP,0)) 
                    ELSE SUM(NVL(D2_SHP,0)) END AS D2_SHP 
             , CASE WHEN SUM(NVL(SUM_D3_PLN,0)) - SUM(NVL(SUM_D2_SHP,0)) <= 0 THEN 0 
                    WHEN SUM(NVL(SUM_D3_PLN,0)) - SUM(NVL(SUM_D2_SHP,0)) <= SUM(NVL(D3_SHP,0)) THEN SUM(NVL(SUM_D3_PLN,0)) - SUM(NVL(SUM_D2_SHP,0)) 
                    ELSE SUM(NVL(D3_SHP,0)) END AS D3_SHP 
             , CASE WHEN SUM(NVL(SUM_D4_PLN,0)) - SUM(NVL(SUM_D3_SHP,0)) <= 0 THEN 0 
                    WHEN SUM(NVL(SUM_D4_PLN,0)) - SUM(NVL(SUM_D3_SHP,0)) <= SUM(NVL(D4_SHP,0)) THEN SUM(NVL(SUM_D4_PLN,0)) - SUM(NVL(SUM_D3_SHP,0)) 
                    ELSE SUM(NVL(D4_SHP,0)) END AS D4_SHP 
             , CASE WHEN SUM(NVL(SUM_D5_PLN,0)) - SUM(NVL(SUM_D4_SHP,0)) <= 0 THEN 0 
                    WHEN SUM(NVL(SUM_D5_PLN,0)) - SUM(NVL(SUM_D4_SHP,0)) <= SUM(NVL(D5_SHP,0)) THEN SUM(NVL(SUM_D5_PLN,0)) - SUM(NVL(SUM_D4_SHP,0)) 
                    ELSE SUM(NVL(D5_SHP,0)) END AS D5_SHP 
             , CASE WHEN SUM(NVL(SUM_D6_PLN,0)) - SUM(NVL(SUM_D5_SHP,0)) <= 0 THEN 0 
                    WHEN SUM(NVL(SUM_D6_PLN,0)) - SUM(NVL(SUM_D5_SHP,0)) <= SUM(NVL(D6_SHP,0)) THEN SUM(NVL(SUM_D6_PLN,0)) - SUM(NVL(SUM_D5_SHP,0)) 
                    ELSE SUM(NVL(D6_SHP,0)) END AS D6_SHP 
             , CASE WHEN SUM(NVL(WW_PLN,0)) <= SUM(NVL(SUM_D6_SHP,0)) THEN SUM(NVL(WW_PLN,0)) ELSE SUM(NVL(SUM_D6_SHP,0)) END AS WW_SHP_2
          FROM (
                SELECT A.*
                     , CASE WHEN A.FACTORY = 'HMKT1' AND A.MAT_GRP_1 = 'FC' AND INSTR(A.MAT_ID, '-') = 0 THEN A.MAT_ID
                            WHEN A.FACTORY = 'HMKT1' AND A.MAT_GRP_1 = 'FC' THEN SUBSTR(A.MAT_ID, 1, INSTR(A.MAT_ID, '-')-1) || A.MAT_CMF_11
                            WHEN A.FACTORY = 'HMKT1' AND A.MAT_GRP_1 = 'FS' THEN SUBSTR(A.MAT_ID, 1, 5) || SUBSTR(A.MAT_ID, -3)
                            WHEN A.FACTORY = 'HMKT1' THEN A.MAT_CMF_7
                            WHEN A.MAT_GRP_1 = 'SE' AND A.MAT_GRP_9 = 'MEMORY' THEN 'SEK_________-___' || SUBSTR(A.MAT_ID, -3)
                            WHEN A.MAT_GRP_1 = 'HX' THEN A.MAT_CMF_10
                            WHEN A.MAT_GRP_1 = 'CC' THEN A.MAT_CMF_8
                            ELSE A.MAT_ID
                       END CONV_MAT_ID
                     , NVL((SELECT DATA_10 FROM MGCMTBLDAT WHERE TABLE_NAME = 'H_CUSTOMER' AND FACTORY = 'HMVA2' AND  KEY_1 = MAT_GRP_1), '-') AS CUST_TYPE 
                     , B.*, C.*
                  FROM MWIPMATDEF A
                     , DT B
                     , (
                        SELECT MAT_ID, D0_QTY AS D0_PLN, D1_QTY AS D1_PLN, D2_QTY AS D2_PLN
                             , D3_QTY AS D3_PLN, D4_QTY AS D4_PLN, D5_QTY AS D5_PLN, D6_QTY AS D6_PLN
                             , D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY + D5_QTY + D6_QTY AS WW_PLN
                             , D0_QTY + D1_QTY AS SUM_D1_PLN
                             , D0_QTY + D1_QTY + D2_QTY AS SUM_D2_PLN
                             , D0_QTY + D1_QTY + D2_QTY + D3_QTY AS SUM_D3_PLN
                             , D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY AS SUM_D4_PLN
                             , D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY + D5_QTY AS SUM_D5_PLN
                             , D0_QTY + D1_QTY + D2_QTY + D3_QTY + D4_QTY + D5_QTY + D6_QTY AS SUM_D6_PLN
                          FROM (
                                SELECT MAT_ID, D0_QTY, D1_QTY, D2_QTY, D3_QTY, D4_QTY, D5_QTY, D6_QTY
                                  FROM RWIPPLNWEK
                                 WHERE FACTORY = 'HMVA2'
                                   AND PLAN_WEEK = '202020'
                                   AND GUBUN = '3'
                                   AND MAT_ID NOT LIKE 'SES%'
                                 UNION ALL
                                SELECT MAT_ID
                                     , SUM(DECODE(PLAN_WEEK, '202019', D5_QTY, 0)) AS D0_QTY
                                     , SUM(DECODE(PLAN_WEEK, '202019', D6_QTY, 0)) AS D1_QTY
                                     , SUM(DECODE(PLAN_WEEK, '202020', D0_QTY, 0)) AS D2_QTY
                                     , SUM(DECODE(PLAN_WEEK, '202020', D1_QTY, 0)) AS D3_QTY
                                     , SUM(DECODE(PLAN_WEEK, '202020', D2_QTY, 0)) AS D4_QTY
                                     , SUM(DECODE(PLAN_WEEK, '202020', D3_QTY, 0)) AS D5_QTY
                                     , SUM(DECODE(PLAN_WEEK, '202020', D4_QTY, 0)) AS D6_QTY
                                  FROM RWIPPLNWEK
                                 WHERE FACTORY = 'HMVA2'
                                   AND PLAN_WEEK IN ('202019', '202020')
                                   AND GUBUN = '3'
                                   AND MAT_ID LIKE 'SES%'
                                 GROUP BY MAT_ID 
                               )
                       ) C
                 WHERE 1=1
                   AND A.MAT_ID = B.MAT_ID(+)
                   AND A.MAT_ID = C.MAT_ID(+)
                   AND A.FACTORY = 'HMVA2'
                   AND A.MAT_TYPE = 'FG'
                   AND A.DELETE_FLAG = ' '
                   AND A.MAT_GRP_3 <> 'COB'
                   AND A.MAT_ID LIKE '%'
               )
         GROUP BY CUST_TYPE, MAT_GRP_1, MAT_GRP_2, MAT_GRP_4, MAT_GRP_6, MAT_GRP_9, MAT_GRP_10, MAT_CMF_11, CONV_MAT_ID
       )
 GROUP BY CUST_TYPE, MAT_GRP_1, MAT_GRP_9,  ' ',  ' ',  ' ',  ' ', CONV_MAT_ID,  ' '
HAVING SUM(NVL(D0_PLN,0) + NVL(D1_PLN,0) + NVL(D2_PLN,0) + NVL(D3_PLN,0) + NVL(D4_PLN,0) + NVL(D5_PLN,0) + NVL(D6_PLN,0) + NVL(WW_PLN_2,0) + NVL(WW_SHP_2,0)) > 0 
 ORDER BY DECODE(CUST_TYPE, 'SEC', 1, 'Hynix', 2, 'Fabless', 3, 4), MAT_GRP_1, MAT_GRP_9,  ' ',  ' ',  ' ',  ' ', CONV_MAT_ID,  ' '

-------------------------------------------------------------
SELECT * FROM RWEBUSRDEF WHERE FACTORY = :FACTORY AND USER_ID= :USER_ID
-------------------------------------------------------------
SELECT COUNT(*)
FROM RWEBFUNLOG
WHERE FACTORY = :FACTORY  
AND USER_ID = :USER_ID 
AND FUNC_NAME = :FUNC_NAME 
AND FUNC_GROUP = :FUNC_GROUP
AND VIEW_TIME BETWEEN TO_CHAR(SYSDATE - 10/1440, 'YYYYMMDDHH24MISS') AND TO_CHAR(SYSDATE + 10/1440, 'YYYYMMDDHH24MISS')
-------------------------------------------------------------
INSERT INTO RWEBFUNLOG(FACTORY,USER_ID,FUNC_NAME,FUNC_GROUP,VIEW_TIME, UPDATE_TIME)
VALUES (:p_FACTORY, :p_USER_ID, :p_FUNC_NAME, :p_FUNC_GROUP,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'))

-------------------------------------------------------------
SELECT A.FUNC_GRP_SEQ,A.SEC_GRP_ID,A.FUNC_GRP_ID,NVL(A.FUNC_NAME, ' ') FUNC_NAME, NVL(B.FUNC_DESC, ' ') FUNC_DESC, LANGUAGE_1, LANGUAGE_2, LANGUAGE_3
  FROM RWEBGRPFUN A, RWEBFUNDEF B
 WHERE A.FACTORY = :p_FACTORY
   AND A.SEC_GRP_ID = :p_SEC_GRP_ID
   AND A.FUNC_NAME=B.FUNC_NAME(+)
 ORDER BY A.FUNC_GRP_SEQ, A.FUNC_SEQ
-------------------------------------------------------------
