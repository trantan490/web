using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.Data;
using System.Text;
using System.Windows.Forms;

using Miracom.UI;
using Miracom.SmartWeb;
using Miracom.SmartWeb.UI;
using Miracom.SmartWeb.FWX;
using Miracom.SmartWeb.UI.Controls;

namespace Hana.PQC
{
    public partial class PQC031205 : Miracom.SmartWeb.UI.Controls.udcCUSReport002
    {
        #region " PQC031205 : Program Initial "

        public PQC031205()
        {
            InitializeComponent();

            this.SetFactory(GlobalVariable.gsAssyDefaultFactory);
            cdvFactory.Text = GlobalVariable.gsAssyDefaultFactory;

            cdvDate.Value = System.DateTime.Now;

            cboGraph.SelectedIndex = 0;
        }

        #endregion


        #region " Common Function "

        private void fnSSInitial(Miracom.SmartWeb.UI.Controls.udcFarPoint SS)
        {
            /****************************************************
             * Comment : SS의 Header를 설정한다.
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By : 
             ****************************************************/
            //월
            string squery = "";
            DataTable dt = null;

            // 분기
            string squery1 = "";
            DataTable dtQuarter = null;

            int iindex = 0;
            try
            {
                Cursor.Current = Cursors.WaitCursor;

                SS.RPT_ColumnInit();

                string todate = cdvDate.Value.ToString("yyyyMMddHHmmss");

                squery1 = "SELECT CASE WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 3 > 0 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) || 'Y ' || TO_CHAR(TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 3) || 'Q' \n"
                        + "            WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 3 = 0 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) - 1 || 'Y ' || '4' || 'Q' \n"
                        + "            WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 3 = -1 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) - 1 || 'Y ' || '3' || 'Q' \n"
                        + "            WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 3 = -2 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) - 1 || 'Y ' || '2' || 'Q' \n"
                        + "       END AS Q4, \n"
                        + "       CASE WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 2 > 0 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) || 'Y ' || TO_CHAR(TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 2)|| 'Q' \n"
                        + "            WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 2 = 0 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) - 1 || 'Y ' || '4' || 'Q' \n"
                        + "            WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 2 = -1 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) - 1 || 'Y ' || '3' || 'Q' \n"
                        + "       END AS Q3, \n"
                        + "       CASE WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 1 > 0 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) || 'Y ' || TO_CHAR(TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 1)|| 'Q' \n"
                        + "            WHEN TO_CHAR(TO_DATE('" + todate + "'), 'Q') - 1 = 0 \n"
                        + "            THEN SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) - 1 || 'Y ' || '4' || 'Q' \n"
                        + "            END AS Q2, \n"
                        + "            SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYY'),3,2) || 'Y ' || TO_CHAR(TO_DATE('" + todate + "'), 'Q') || 'Q' AS Q1 \n"
                        + "  FROM DUAL";

                dtQuarter = CmnFunction.oComm.GetFuncDataTable("DYNAMIC", squery1.Replace((char)Keys.Tab, ' '));

                squery = "SELECT SUBSTR(TO_CHAR(TO_DATE('" + todate + "'),'YYYYMM'),5,2)||'월' AS MM7 \n"
                               + "	   , SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE('" + todate + "'),-1),'YYYYMM'),5,2)||'월' AS MM6 \n"
                               + "	   , SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE('" + todate + "'),-2),'YYYYMM'),5,2)||'월' AS MM5 \n"
                               + "	   , SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE('" + todate + "'),-3),'YYYYMM'),5,2)||'월' AS MM4 \n"
                               + "	   , SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE('" + todate + "'),-4),'YYYYMM'),5,2)||'월' AS MM3 \n"
                               + "	   , SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE('" + todate + "'),-5),'YYYYMM'),5,2)||'월' AS MM2 \n"
                               + "	   , SUBSTR(TO_CHAR(ADD_MONTHS(TO_DATE('" + todate + "'),-6),'YYYYMM'),5,2)||'월' AS MM1 \n"
                               + "  FROM DUAL";

                dt = CmnFunction.oComm.GetFuncDataTable("DYNAMIC", squery.Replace((char)Keys.Tab, ' '));

                switch (cboGraph.SelectedIndex)
                {
                    case 0:
                    case 2:
                        SS.RPT_AddBasicColumn("Operation Name", 0, iindex, Visibles.True, Frozen.False, Align.Center, Merge.True, Formatter.String, 100);
                        break;

                    case 1:
                    case 3:
                        SS.RPT_AddBasicColumn("Defect Mode", 0, iindex, Visibles.True, Frozen.False, Align.Center, Merge.True, Formatter.String, 100);
                        break;
                }

                if (dtQuarter.Rows.Count <= 0)
                {
                    dtQuarter.Dispose();
                    SS.RPT_AddBasicColumn("Q-1", 0, iindex + 1, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("Q-2", 0, iindex + 2, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("Q-3", 0, iindex + 3, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("Q-4", 0, iindex + 4, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                }
                else
                {
                    SS.RPT_AddBasicColumn(dtQuarter.Rows[0][0].ToString(), 0, iindex + 1, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dtQuarter.Rows[0][1].ToString(), 0, iindex + 2, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dtQuarter.Rows[0][2].ToString(), 0, iindex + 3, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dtQuarter.Rows[0][3].ToString(), 0, iindex + 4, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                }

                if (dt.Rows.Count <= 0)
                {
                    dt.Dispose();
                    SS.RPT_AddBasicColumn("MM-1", 0, iindex + 5, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("MM-2", 0, iindex + 6, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("MM-3", 0, iindex + 7, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("MM-4", 0, iindex + 8, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("MM-5", 0, iindex + 9, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("MM-6", 0, iindex + 10, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn("MM-7", 0, iindex + 11, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                }
                else
                {
                    SS.RPT_AddBasicColumn(dt.Rows[0][6].ToString(), 0, iindex + 5, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dt.Rows[0][5].ToString(), 0, iindex + 6, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dt.Rows[0][4].ToString(), 0, iindex + 7, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dt.Rows[0][3].ToString(), 0, iindex + 8, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dt.Rows[0][2].ToString(), 0, iindex + 9, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dt.Rows[0][1].ToString(), 0, iindex + 10, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                    SS.RPT_AddBasicColumn(dt.Rows[0][0].ToString(), 0, iindex + 11, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);
                }

                SS.RPT_AddBasicColumn("Total (month)", 0, 12, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Number, 80);

                //switch (cboGraph.SelectedIndex)
                //{
                //    case 0:
                //    case 2:
                //        SS.RPT_AddBasicColumn("percentage", 0, 13, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Double1, 80);
                //        break;
                //}
            }
            catch (Exception ex)
            {
                CmnFunction.ShowMsgBox(ex.Message);
                return;
            }
            finally
            {
                Cursor.Current = Cursors.Default;
            }
        }

        private bool fnDataFind()
        {
            /****************************************************
             * Comment : DataBase에 저장된 데이터를 조회한다.
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/
            DataTable dt = null;
            string QRY = "";
            int iEndrow = 0;

            try
            {
                Cursor.Current = Cursors.WaitCursor;
                LoadingPopUp.LoadIngPopUpShow(this);

                // Sheet / Listview를 초기화 한다.
                CmnInitFunction.ClearList(spdData, true);

                switch (cboGraph.SelectedIndex)
                {
                    // QCN 공정별 누적 현황
                    case 0:
                        QRY = MakeSqlString();
                        iEndrow = 8;
                        break;

                    // QCN MODE별 누적 현황
                    case 1:
                        QRY = MakeSqlString1();
                        iEndrow = 6;
                        break;

                    // CCN 공정별 누적 현황
                    case 2:
                        QRY = MakeSqlString2();
                        iEndrow = 9;
                        break;

                    // CCN MODE별 누적 현황
                    case 3:
                        QRY = MakeSqlString3();
                        iEndrow = 6;
                        break;
                }

                if (GlobalVariable.gsUserGroup == "ADMIN_GROUP" || GlobalVariable.gsUserGroup == "HANA_ADMIN_GROUP")
                {
                    System.Windows.Forms.Clipboard.SetText(QRY);
                }

                dt = CmnFunction.oComm.GetFuncDataTable("DYNAMIC", QRY);

                if (dt.Rows.Count == 0)
                {
                    dt.Dispose();
                    LoadingPopUp.LoadingPopUpHidden();
                    CmnFunction.ShowMsgBox(RptMessages.GetMessage("STD010", GlobalVariable.gcLanguage));
                    return false;
                }

                spdData.DataSource = dt;
                spdData.RPT_AutoFit(false);

                for (int irow = 0; irow < spdData_Sheet1.RowCount; irow++)
                {
                    switch (cboGraph.SelectedIndex)
                    {
                        // QCN/CCN 공정별 월 합의 백분율을 구한다.
                        case 0:
                        case 2:
                            spdData.RPT_AddBasicColumn("percentage", 0, 13, Visibles.True, Frozen.False, Align.Right, Merge.False, Formatter.Double1, 80);

                            spdData_Sheet1.Cells[irow, 13].Value = 
                                Math.Round(CmnFunction.ToDbl(spdData_Sheet1.Cells[irow, 12].Value) / CmnFunction.ToDbl(spdData_Sheet1.Cells[spdData_Sheet1.RowCount - 1, 12].Value) * 100, 1);
                            break;

                        // QCN/CCN MODE별 누적 현황 Top 6에 폰트 컬러를 다르게 표시한다.
                        case 1:
                        case 3:
                            if (irow < 6)
                            {
                                spdData_Sheet1.Rows[irow].ForeColor = Color.Tomato;
                            }
                            break;
                    }

                    // 총계 Row의 바탕색을 다르게 표시한다.
                    if (spdData_Sheet1.Cells[irow, 0].Text.Contains("총계"))
                    {
                        spdData_Sheet1.Rows[irow].BackColor = Color.Yellow;
                    }
                }

                fnMakeChart(spdData, 0, iEndrow);

                return true;
            }
            catch (Exception ex)
            {
                LoadingPopUp.LoadingPopUpHidden();
                MessageBox.Show(ex.Message);
                return false;
            }
            finally
            {
                LoadingPopUp.LoadingPopUpHidden();
                Cursor.Current = Cursors.Default;
            }
        }

        private string MakeSqlString()
        {
            /****************************************************
             * Comment : DataBase에 저장된 데이터를 조회한다.(QCN 공정별 누적 현황)
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/

            string QRY = "";

            string date = cdvDate.Value.ToString("yyyyMMddHHmmss");

            QRY = "	SELECT DECODE(OPER, NULL, '총계', OPER) AS OPER	\n"
                + "	    , SUM(QTY_QQ_1) AS QTY_QQ_1	\n"
                + "	    , SUM(QTY_QQ_2) AS QTY_QQ_2	\n"
                + "	    , SUM(QTY_QQ_3) AS QTY_QQ_3	\n"
                + "	    , SUM(QTY_QQ_4) AS QTY_QQ_4	\n"
                + "	    , SUM(QTY_MM_1) AS QTY_MM_1	\n"
                + "	    , SUM(QTY_MM_2) AS QTY_MM_2	\n"
                + "	    , SUM(QTY_MM_3) AS QTY_MM_3	\n"
                + "	    , SUM(QTY_MM_4) AS QTY_MM_4	\n"
                + "	    , SUM(QTY_MM_5) AS QTY_MM_5	\n"
                + "	    , SUM(QTY_MM_6) AS QTY_MM_6	\n"
                + "	    , SUM(QTY_MM_7) AS QTY_MM_7	\n"
                + "	    , SUM(QTY_MM_1 + QTY_MM_2 + QTY_MM_3 + QTY_MM_4 + QTY_MM_5 + QTY_MM_6 + QTY_MM_7) AS TOTAL	\n"
                + "	FROM(	\n"
                + "	    SELECT 'PVI GATE' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A2100'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'PVI GATE' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A2100'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'IVI GATE' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND OPER_1 >= 'A0800'	\n"
                + "	    AND OPER_1 <= 'A0809'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'IVI GATE' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND OPER_1 >= 'A0800'	\n"
                + "	    AND OPER_1 <= 'A0809'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'W/B' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0600'	\n"
                + "	    AND STS.OPER_1 <= 'A0609'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'W/B' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0600'	\n"
                + "	    AND STS.OPER_1 <= 'A0609'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'M/D' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A1000'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'M/D' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A1000'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'FINISH' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 > 'A1000'	\n"
                + "	    AND STS.OPER_1 <= 'A2050'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'FINISH' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 > 'A1000'	\n"
                + "	    AND STS.OPER_1 <= 'A2050'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'D/A' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0400'	\n"
                + "	    AND STS.OPER_1 <= 'A0409'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'D/A' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0400'	\n"
                + "	    AND STS.OPER_1 <= 'A0409'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'SAW' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0200'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'SAW' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0200'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'B/G' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0040'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'B/G' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0040'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'QCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	)GROUP BY ROLLUP (OPER)	\n";
            
            return QRY.Replace((char)Keys.Tab, ' ');
        }

        private string MakeSqlString1()
        {
            /****************************************************
             * Comment : DataBase에 저장된 데이터를 조회한다.(QCN MODE별 누적 현황)
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/

            string QRY = "";

            string date = cdvDate.Value.ToString("yyyyMMddHHmmss");

            QRY = "	SELECT DEFECT	\n"
                + "	    , QTY_QQ_1, QTY_QQ_2, QTY_QQ_3, QTY_QQ_4	\n"
                + "	    , QTY_MM_1, QTY_MM_2, QTY_MM_3, QTY_MM_4, QTY_MM_5, QTY_MM_6, QTY_MM_7	\n"
                + "	    , TOTAL	\n"
                + "	FROM	\n"
                + "	(	\n"
                + "	    SELECT DECODE(CASE WHEN TOTAL > 4 THEN DEFECT ELSE '기타' END	\n"
                + "	                    , NULL, '총계'	\n"
                + "	                    , CASE WHEN TOTAL > 4 THEN DEFECT ELSE '기타' END) AS DEFECT	\n"
                + "	        , SUM(QTY_QQ_1) AS QTY_QQ_1	\n"
                + "	        , SUM(QTY_QQ_2) AS QTY_QQ_2	\n"
                + "	        , SUM(QTY_QQ_3) AS QTY_QQ_3	\n"
                + "	        , SUM(QTY_QQ_4) AS QTY_QQ_4	\n"
                + "	        , SUM(QTY_MM_1) AS QTY_MM_1	\n"
                + "	        , SUM(QTY_MM_2) AS QTY_MM_2	\n"
                + "	        , SUM(QTY_MM_3) AS QTY_MM_3	\n"
                + "	        , SUM(QTY_MM_4) AS QTY_MM_4	\n"
                + "	        , SUM(QTY_MM_5) AS QTY_MM_5	\n"
                + "	        , SUM(QTY_MM_6) AS QTY_MM_6	\n"
                + "	        , SUM(QTY_MM_7) AS QTY_MM_7	\n"
                + "	        , SUM(TOTAL) AS TOTAL	\n"
                + "	    FROM	\n"
                + "	    (	\n"
                + "	        SELECT DEFECT	\n"
                + "	            , SUM(QTY_QQ_1) AS QTY_QQ_1	\n"
                + "	            , SUM(QTY_QQ_2) AS QTY_QQ_2	\n"
                + "	            , SUM(QTY_QQ_3) AS QTY_QQ_3	\n"
                + "	            , SUM(QTY_QQ_4) AS QTY_QQ_4	\n"
                + "	            , SUM(QTY_MM_1) AS QTY_MM_1	\n"
                + "	            , SUM(QTY_MM_2) AS QTY_MM_2	\n"
                + "	            , SUM(QTY_MM_3) AS QTY_MM_3	\n"
                + "	            , SUM(QTY_MM_4) AS QTY_MM_4	\n"
                + "	            , SUM(QTY_MM_5) AS QTY_MM_5	\n"
                + "	            , SUM(QTY_MM_6) AS QTY_MM_6	\n"
                + "	            , SUM(QTY_MM_7) AS QTY_MM_7	\n"
                + "	            , SUM(QTY_MM_1 + QTY_MM_2 + QTY_MM_3 + QTY_MM_4 + QTY_MM_5 + QTY_MM_6 + QTY_MM_7) AS TOTAL	\n"
                + "	        FROM(	\n"
                + "	            SELECT DEF.DESC_1 AS DEFECT	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_1	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_2	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_3	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_4	\n"
                + "	                , 0 AS QTY_MM_1	\n"
                + "	                , 0 AS QTY_MM_2	\n"
                + "	                , 0 AS QTY_MM_3	\n"
                + "	                , 0 AS QTY_MM_4	\n"
                + "	                , 0 AS QTY_MM_5	\n"
                + "	                , 0 AS QTY_MM_6	\n"
                + "	                , 0 AS QTY_MM_7	\n"
                + "	            FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	            WHERE 1=1	\n"
                + "	            AND STS.FACTORY = DEF.FACTORY	\n"
                + "	            AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	            AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	            AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STS.OPER_1 >= 'A0000'	\n"
                + "	            AND STS.OPER_1 <= 'AZ010'	\n"
                + "	            AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	            AND ABR_NO LIKE 'QCN%'	\n"
                + "	            AND STS.DEL_FLAG = ' '	\n"
                + "	            AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	            GROUP BY DEF.DESC_1	\n"
                + "	            UNION ALL	\n"
                + "	            SELECT DEF.DESC_1 AS DEFECT	\n"
                + "	                , 0 AS QTY_QQ_1	\n"
                + "	                , 0 AS QTY_QQ_2	\n"
                + "	                , 0 AS QTY_QQ_3	\n"
                + "	                , 0 AS QTY_QQ_4	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_1	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_2	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_3	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_4	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_5	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_6	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_7	\n"
                + "	            FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	            WHERE 1=1	\n"
                + "	            AND STS.FACTORY = DEF.FACTORY	\n"
                + "	            AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	            AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	            AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STS.OPER_1 >= 'A0000'	\n"
                + "	            AND STS.OPER_1 <= 'AZ010'	\n"
                + "	            AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	            AND ABR_NO LIKE 'QCN%'	\n"
                + "	            AND STS.DEL_FLAG = ' '	\n"
                + "	            AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	            GROUP BY DEF.DESC_1	\n"
                + "	        )GROUP BY DEFECT	\n"
                + "	        ORDER BY TOTAL DESC	\n"
                + "	    )GROUP BY ROLLUP (CASE WHEN TOTAL > 4	\n"
                + "	                           THEN DEFECT	\n"
                + "	                           ELSE '기타'	\n"
                + "	                      END)	\n"
                + "	    ORDER BY DECODE(DEFECT, '총계', 0, '기타', 1) DESC , TOTAL DESC	\n"
                + "	)	\n";

            return QRY.Replace((char)Keys.Tab, ' ');
        }

        private string MakeSqlString2()
        {
            /****************************************************
             * Comment : DataBase에 저장된 데이터를 조회한다.(CCN 공정별 누적 현황)
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/

            string QRY = "";

            string date = cdvDate.Value.ToString("yyyyMMddHHmmss");

            QRY = "	SELECT DECODE(OPER, NULL, '총계', OPER) AS OPER	\n"
                + "	    , SUM(QTY_QQ_1) AS QTY_QQ_1	\n"
                + "	    , SUM(QTY_QQ_2) AS QTY_QQ_2	\n"
                + "	    , SUM(QTY_QQ_3) AS QTY_QQ_3	\n"
                + "	    , SUM(QTY_QQ_4) AS QTY_QQ_4	\n"
                + "	    , SUM(QTY_MM_1) AS QTY_MM_1	\n"
                + "	    , SUM(QTY_MM_2) AS QTY_MM_2	\n"
                + "	    , SUM(QTY_MM_3) AS QTY_MM_3	\n"
                + "	    , SUM(QTY_MM_4) AS QTY_MM_4	\n"
                + "	    , SUM(QTY_MM_5) AS QTY_MM_5	\n"
                + "	    , SUM(QTY_MM_6) AS QTY_MM_6	\n"
                + "	    , SUM(QTY_MM_7) AS QTY_MM_7	\n"
                + "	    , SUM(QTY_MM_1 + QTY_MM_2 + QTY_MM_3 + QTY_MM_4 + QTY_MM_5 + QTY_MM_6 + QTY_MM_7) AS TOTAL	\n"
                + "	FROM(	\n"
                + "	    SELECT 'B/G' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0040'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'B/G' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0040'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'SAW' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0200'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'SAW' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A0200'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'D/A' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0400'	\n"
                + "	    AND STS.OPER_1 <= 'A0409'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'D/A' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0400'	\n"
                + "	    AND STS.OPER_1 <= 'A0409'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'W/B' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0600'	\n"
                + "	    AND STS.OPER_1 <= 'A0609'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'W/B' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A0600'	\n"
                + "	    AND STS.OPER_1 <= 'A0609'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'M/D' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A1000'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'M/D' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A1000'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'M/K' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A1110'	\n"
                + "	    AND STS.OPER_1 <= 'A1150'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'M/K' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A1110'	\n"
                + "	    AND STS.OPER_1 <= 'A1150'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'SBA' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A1300'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'SBA' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 = 'A1300'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'SST' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A1720'	\n"
                + "	    AND STS.OPER_1 <= 'A1750'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'SST' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A1720'	\n"
                + "	    AND STS.OPER_1 <= 'A1750'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	        SELECT 'T/F' AS OPER	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_1	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_2	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_3	\n"
                + "	        , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	            WHEN '4' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '3' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '2' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	            WHEN '1' THEN 	\n"
                + "	                        CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                    AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                            THEN 1	\n"
                + "	                            ELSE 0 	\n"
                + "	                        END	\n"
                + "	          END) AS QTY_QQ_4	\n"
                + "	        , 0 AS QTY_MM_1	\n"
                + "	        , 0 AS QTY_MM_2	\n"
                + "	        , 0 AS QTY_MM_3	\n"
                + "	        , 0 AS QTY_MM_4	\n"
                + "	        , 0 AS QTY_MM_5	\n"
                + "	        , 0 AS QTY_MM_6	\n"
                + "	        , 0 AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A1800'	\n"
                + "	    AND STS.OPER_1 <= 'A1900'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	    UNION ALL	\n"
                + "	    SELECT 'T/F' AS OPER	\n"
                + "	        , 0 AS QTY_QQ_1	\n"
                + "	        , 0 AS QTY_QQ_2	\n"
                + "	        , 0 AS QTY_QQ_3	\n"
                + "	        , 0 AS QTY_QQ_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_1	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_2	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_3	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_4	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_5	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_6	\n"
                + "	        , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                        AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                   THEN 1	\n"
                + "	                   ELSE 0	\n"
                + "	              END) AS QTY_MM_7	\n"
                + "	    FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	    WHERE 1=1	\n"
                + "	    AND STS.FACTORY = DEF.FACTORY	\n"
                + "	    AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	    AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	    AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	    AND STS.OPER_1 >= 'A1800'	\n"
                + "	    AND STS.OPER_1 <= 'A1900'	\n"
                + "	    AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	    AND ABR_NO LIKE 'CCN%'	\n"
                + "	    AND STS.DEL_FLAG = ' '	\n"
                + "	    AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	    GROUP BY DEF.DESC_1	\n"
                + "	)GROUP BY ROLLUP (OPER)	\n";

            return QRY.Replace((char)Keys.Tab, ' ');
        }

        private string MakeSqlString3()
        {
            /****************************************************
             * Comment : DataBase에 저장된 데이터를 조회한다.(CCN MODE별 누적 현황)
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/

            string QRY = "";

            string date = cdvDate.Value.ToString("yyyyMMddHHmmss");

            QRY = "	SELECT DEFECT	\n"
                + "	    , QTY_QQ_1, QTY_QQ_2, QTY_QQ_3, QTY_QQ_4	\n"
                + "	    , QTY_MM_1, QTY_MM_2, QTY_MM_3, QTY_MM_4, QTY_MM_5, QTY_MM_6, QTY_MM_7	\n"
                + "	    , TOTAL	\n"
                + "	FROM	\n"
                + "	(	\n"
                + "	    SELECT DECODE(CASE WHEN TOTAL > 2 THEN DEFECT ELSE '기타' END	\n"
                + "	                    , NULL, '총계'	\n"
                + "	                    , CASE WHEN TOTAL > 2 THEN DEFECT ELSE '기타' END) AS DEFECT	\n"
                + "	        , SUM(QTY_QQ_1) AS QTY_QQ_1	\n"
                + "	        , SUM(QTY_QQ_2) AS QTY_QQ_2	\n"
                + "	        , SUM(QTY_QQ_3) AS QTY_QQ_3	\n"
                + "	        , SUM(QTY_QQ_4) AS QTY_QQ_4	\n"
                + "	        , SUM(QTY_MM_1) AS QTY_MM_1	\n"
                + "	        , SUM(QTY_MM_2) AS QTY_MM_2	\n"
                + "	        , SUM(QTY_MM_3) AS QTY_MM_3	\n"
                + "	        , SUM(QTY_MM_4) AS QTY_MM_4	\n"
                + "	        , SUM(QTY_MM_5) AS QTY_MM_5	\n"
                + "	        , SUM(QTY_MM_6) AS QTY_MM_6	\n"
                + "	        , SUM(QTY_MM_7) AS QTY_MM_7	\n"
                + "	        , SUM(TOTAL) AS TOTAL	\n"
                + "	    FROM	\n"
                + "	    (	\n"
                + "	        SELECT DEFECT	\n"
                + "	            , SUM(QTY_QQ_1) AS QTY_QQ_1	\n"
                + "	            , SUM(QTY_QQ_2) AS QTY_QQ_2	\n"
                + "	            , SUM(QTY_QQ_3) AS QTY_QQ_3	\n"
                + "	            , SUM(QTY_QQ_4) AS QTY_QQ_4	\n"
                + "	            , SUM(QTY_MM_1) AS QTY_MM_1	\n"
                + "	            , SUM(QTY_MM_2) AS QTY_MM_2	\n"
                + "	            , SUM(QTY_MM_3) AS QTY_MM_3	\n"
                + "	            , SUM(QTY_MM_4) AS QTY_MM_4	\n"
                + "	            , SUM(QTY_MM_5) AS QTY_MM_5	\n"
                + "	            , SUM(QTY_MM_6) AS QTY_MM_6	\n"
                + "	            , SUM(QTY_MM_7) AS QTY_MM_7	\n"
                + "	            , SUM(QTY_MM_1 + QTY_MM_2 + QTY_MM_3 + QTY_MM_4 + QTY_MM_5 + QTY_MM_6 + QTY_MM_7) AS TOTAL	\n"
                + "	        FROM(	\n"
                + "	            SELECT DEF.DESC_1 AS DEFECT	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_1	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_2	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_3	\n"
                + "	                , SUM(CASE TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'Q')	\n"
                + "	                    WHEN '4' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'09', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '3' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'06', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '2' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')||'03', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                    WHEN '1' THEN 	\n"
                + "	                                CASE WHEN STS.STEP10_TIME >= TO_CHAR(LAST_DAY(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM')), 'YYYYMMDD')||'220000'	\n"
                + "	                                            AND STS.STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYY')-1||'12', 'YYYYMM'), 3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                    THEN 1	\n"
                + "	                                    ELSE 0 	\n"
                + "	                                END	\n"
                + "	                  END) AS QTY_QQ_4	\n"
                + "	                , 0 AS QTY_MM_1	\n"
                + "	                , 0 AS QTY_MM_2	\n"
                + "	                , 0 AS QTY_MM_3	\n"
                + "	                , 0 AS QTY_MM_4	\n"
                + "	                , 0 AS QTY_MM_5	\n"
                + "	                , 0 AS QTY_MM_6	\n"
                + "	                , 0 AS QTY_MM_7	\n"
                + "	            FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	            WHERE 1=1	\n"
                + "	            AND STS.FACTORY = DEF.FACTORY	\n"
                + "	            AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	            AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	            AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -13)), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STS.OPER_1 >= 'A0000'	\n"
                + "	            AND STS.OPER_1 <= 'AZ010'	\n"
                + "	            AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	            AND ABR_NO LIKE 'CCN%'	\n"
                + "	            AND STS.DEL_FLAG = ' '	\n"
                + "	            AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	            GROUP BY DEF.DESC_1	\n"
                + "	            UNION ALL	\n"
                + "	            SELECT DEF.DESC_1 AS DEFECT	\n"
                + "	                , 0 AS QTY_QQ_1	\n"
                + "	                , 0 AS QTY_QQ_2	\n"
                + "	                , 0 AS QTY_QQ_3	\n"
                + "	                , 0 AS QTY_QQ_4	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_1	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -6)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_2	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -5)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_3	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -4)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_4	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -3)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_5	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -2)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_6	\n"
                + "	                , SUM(CASE WHEN STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -1)), 'YYYYMMDD')||'220000'	\n"
                + "	                                AND STEP10_TIME < TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -0)), 'YYYYMMDD')||'220000'	\n"
                + "	                           THEN 1	\n"
                + "	                           ELSE 0	\n"
                + "	                      END) AS QTY_MM_7	\n"
                + "	            FROM CABRLOTSTS@RPTTOMES STS, CABRDFTDEF@RPTTOMES DEF	\n"
                + "	            WHERE 1=1	\n"
                + "	            AND STS.FACTORY = DEF.FACTORY	\n"
                + "	            AND STS.FACTORY = '" + cdvFactory.Text + "'	\n"
                + "	            AND STS.DEFECT_CODE = DEF.DEFECT_CODE	\n"
                + "	            AND STEP10_TIME >= TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), -7)), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STEP10_TIME < TO_CHAR(TO_DATE('" + date + "', 'YYYYMMDD HH24MISS'), 'YYYYMMDD')||'220000'	\n"
                + "	            AND STS.OPER_1 >= 'A0000'	\n"
                + "	            AND STS.OPER_1 <= 'AZ010'	\n"
                + "	            AND CLOSE_FLAG IN ( ' ', 'Y')	\n"
                + "	            AND ABR_NO LIKE 'CCN%'	\n"
                + "	            AND STS.DEL_FLAG = ' '	\n"
                + "	            AND STS.CUS_ID = '" + cdvCustomer.Text + "'	\n"
                + "	            GROUP BY DEF.DESC_1	\n"
                + "	        )GROUP BY DEFECT	\n"
                + "	        ORDER BY TOTAL DESC	\n"
                + "	    )GROUP BY ROLLUP (CASE WHEN TOTAL > 2	\n"
                + "	                           THEN DEFECT	\n"
                + "	                           ELSE '기타'	\n"
                + "	                      END)	\n"
                + "	    ORDER BY DECODE(DEFECT, '총계', 0, '기타', 1) DESC , TOTAL DESC	\n"
                + "	)	\n";

            return QRY.Replace((char)Keys.Tab, ' ');
        }

        private void fnMakeChart(Miracom.SmartWeb.UI.Controls.udcFarPoint SS, int iselrow, int iendrow)
        {
            /****************************************************
             * Comment : SS의 데이터를 Chart에 표시한다.
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/
            int[] ich_mm = new int[4]; int[] icols_mm = new int[4]; int[] irows_mm = new int[7]; string[] stitle_mm = new string[4];

            int icol = 0, irow = 0;
            try
            {
                Cursor.Current = Cursors.WaitCursor;
                // SS에 데이터가 없으면 종료한다.
                if (SS.Sheets[0].RowCount <= 0)
                {
                    return;
                }

                switch (cboGraph.SelectedIndex)
                {
                    case 0:
                        irows_mm = new int[8];
                        break;

                    case 1:
                    case 3:
                        irows_mm = new int[6];
                        break;

                    case 2:
                        irows_mm = new int[9];
                        break;
                }

                cf01.RPT_1_ChartInit(); cf02.RPT_1_ChartInit();
                cf01.RPT_2_ClearData(); cf02.RPT_2_ClearData();
                cf01.ClearData(SoftwareFX.ChartFX.ClearDataFlag.AllData);

                cf01.AxisX.Title.Text = "[ " + cdvCustomer.ValueSelectedItem.SubItems[1].Text + " " + cboGraph.SelectedItem.ToString() + " ]";
                cf01.Gallery = SoftwareFX.ChartFX.Gallery.Bar;

                cf01.AxisY.Gridlines = true;
                cf01.AxisY.Title.Text = "(Count)";
                cf01.AxisY.Title.Alignment = StringAlignment.Far;
                cf01.AxisY.DataFormat.Decimals = 0;

                cf01.AxisX.Staggered = false;

                cf01.PointLabels = true;
                for (icol = 0; icol < ich_mm.Length; icol++)
                {
                    ich_mm[icol] = icol + 8;
                    icols_mm[icol] = icol + 8;
                    stitle_mm[icol] = SS.Sheets[0].ColumnHeader.Cells[0, icol + 8].Text;
                }
                for (irow = 0; irow < iendrow; irow++)
                {
                    irows_mm[irow] = iselrow + irow;
                }

                cf01.RPT_3_OpenData(icols_mm.Length, irows_mm.Length);
                cf01.RPT_4_AddData(SS, irows_mm, icols_mm, SeriseType.Column);
                cf01.RPT_5_CloseData();
                cf01.RPT_7_SetXAsixTitleUsingSpread(SS, irows_mm, 0);
                cf01.RPT_8_SetSeriseLegend(stitle_mm, SoftwareFX.ChartFX.Docked.Top);
                cf01.AxisY.Max = cf01.AxisY.Max * 1.1;

            }
            catch (Exception ex)
            {
                CmnFunction.ShowMsgBox(ex.Message);
                return;
            }
            finally
            {
                Cursor.Current = Cursors.Default;
            }
        }

        #endregion


        #region " Form Event "

        private void btnView_Click(object sender, EventArgs e)
        {
            /****************************************************
             * Comment : View Button을 클릭하면
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By : 
             ****************************************************/
            try
            {
                if (cdvCustomer.Text == "")
                {
                    CmnFunction.ShowMsgBox(RptMessages.GetMessage("STD051", GlobalVariable.gcLanguage));
                    return;
                }

                Cursor.Current = Cursors.WaitCursor;

                fnSSInitial(spdData);

                fnDataFind();
            }
            catch (Exception ex)
            {
                CmnFunction.ShowMsgBox(ex.Message);
                return;
            }
            finally
            {
                Cursor.Current = Cursors.Default;
            }
        }

        private void btnExcelExport_Click(object sender, EventArgs e)
        {
            /****************************************************
             * Comment : Excel Export Button을 클릭하면
             * 
             * Created By : 김선호(2012-08-14-화요일)
             * 
             * Modified By :
             ****************************************************/
            try
            {
                Cursor.Current = Cursors.WaitCursor;

                spdData.ExportExcel();
            }
            catch (Exception ex)
            {
                CmnFunction.ShowMsgBox(ex.Message);
                return;
            }
            finally
            {
                Cursor.Current = Cursors.Default;
            }
        }

        #endregion

    }
}
